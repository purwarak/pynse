<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.8.3" />
<title>pynse.pynse API documentation</title>
<meta name="description" content="" />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js" integrity="sha256-eOgo0OtLL4cdq7RdwRUiGKLX9XsIJ7nGhWEKbohmVAQ=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>pynse.pynse</code></h1>
</header>
<section id="section-intro">
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">import datetime as dt
import time
import enum
import logging
import urllib.parse
import requests
from bs4 import BeautifulSoup
import pandas as pd
import numpy as np
import io
import zipfile
import os
import pickle
from fake_headers import Headers
from pprint import pprint

logging.basicConfig(level=logging.DEBUG)

logger = logging.getLogger(__name__)


class OutputType(enum.Enum):
    pandas = &#39;pd&#39;
    dict = &#39;json&#39;


class Format(enum.Enum):
    pkl = &#39;pkl&#39;
    csv = &#39;csv&#39;


class Segment(enum.Enum):
    EQ = &#39;EQ&#39;
    FUT = &#39;FUT&#39;
    OPT = &#39;OPT&#39;


class OptionType(enum.Enum):
    CE = &#39;Call&#39;
    PE = &#39;Put&#39;


class IndexSymbol(enum.Enum):
    All = &#39;ALL&#39;
    FnO = &#39;FNO&#39;
    Nifty50 = &#39;NIFTY 50&#39;
    NiftyNext50 = &#39;NIFTY NEXT 50&#39;
    Nifty100 = &#39;NIFTY 100&#39;
    Nifty200 = &#39;NIFTY 200&#39;
    Nifty500 = &#39;NIFTY 500&#39;
    NiftyMidcap50 = &#39;NIFTY MIDCAP 50&#39;
    NiftyMidcap100 = &#39;NIFTY MIDCAP 100&#39;
    NiftySmlcap100 = &#39;NIFTY SMLCAP 100&#39;
    NiftyMidcap150 = &#39;NIFTY MIDCAP 150&#39;
    NiftySmlcap50 = &#39;NIFTY SMLCAP 50&#39;
    NiftySmlcap250 = &#39;NIFTY SMLCAP 250&#39;
    NiftyMidsml400 = &#39;NIFTY MIDSML 400&#39;
    NiftyBank = &#39;NIFTY BANK&#39;
    NiftyAuto = &#39;NIFTY AUTO&#39;
    NiftyFinService = &#39;NIFTY FIN SERVICE&#39;
    NiftyFmcg = &#39;NIFTY FMCG&#39;
    NiftyIt = &#39;NIFTY IT&#39;
    NiftyMedia = &#39;NIFTY MEDIA&#39;
    NiftyMetal = &#39;NIFTY METAL&#39;
    NiftyPharma = &#39;NIFTY PHARMA&#39;
    NiftyPsuBank = &#39;NIFTY PSU BANK&#39;
    NiftyPvtBank = &#39;NIFTY PVT BANK&#39;
    NiftyRealty = &#39;NIFTY REALTY&#39;
    Nifty50Value20 = &#39;NIFTY50 VALUE 20&#39;
    NiftyAlpha50 = &#39;NIFTY ALPHA 50&#39;
    Nifty50EqlWgt = &#39;NIFTY50 EQL WGT&#39;
    Nifty100EqlWgt = &#39;NIFTY100 EQL WGT&#39;
    Nifty100Lowvol30 = &#39;NIFTY100 LOWVOL30&#39;
    Nifty200Qualty30 = &#39;NIFTY200 QUALTY30&#39;
    NiftyCommodities = &#39;NIFTY COMMODITIES&#39;
    NiftyConsumption = &#39;NIFTY CONSUMPTION&#39;
    NiftyEnergy = &#39;NIFTY ENERGY&#39;
    NiftyInfra = &#39;NIFTY INFRA&#39;
    NiftyMnc = &#39;NIFTY MNC&#39;
    NiftyPse = &#39;NIFTY PSE&#39;
    NiftyServSector = &#39;NIFTY SERV SECTOR&#39;


class Nse:
    &#34;&#34;&#34;
    pynse is a library to extract realtime and historical data from NSE website

    Examples
    --------

    &gt;&gt;&gt; from pynse import *
    &gt;&gt;&gt; nse = Nse()
    &gt;&gt;&gt; nse.market_status()

    &#34;&#34;&#34;
    __service_config = {&#39;host&#39;: &#39;https://www.nseindia.com&#39;,
                        &#39;path&#39;: {&#39;marketStatus&#39;: &#39;/api/marketStatus&#39;,
                                 &#39;info&#39;: &#34;/api/equity-meta-info?symbol={symbol}&#34;,
                                 &#39;quote_eq&#39;: &#34;/api/quote-equity?symbol={symbol}&#34;,
                                 &#39;quote_derivative&#39;: &#34;/api/quote-derivative?symbol={symbol}&#34;,
                                 &#39;trade_info&#39;: &#34;/api/quote-equity?symbol={symbol}&amp;section=trade_info&#34;,
                                 &#39;hist&#39;: &#34;/api/historical/cm/equity?symbol={symbol}&amp;series=[%22EQ%22]&amp;from={from_date}&amp;to={to_date}&amp;csv=true&#34;,
                                 &#39;bhavcopy&#39;: &#39;https://archives.nseindia.com/products/content/sec_bhavdata_full_{date}.csv&#39;,
                                 &#39;bhavcopy_derivatives&#39;: &#39;https://archives.nseindia.com/content/historical/DERIVATIVES/{year}/{month}/fo{date}bhav.csv.zip&#39;,
                                 &#39;preOpen&#39;: &#34;/api/market-data-pre-open?key=ALL&#34;,
                                 &#39;fii_dii&#39;: &#34;/api/fiidiiTradeReact&#34;,
                                 &#39;option_chain_index&#39;: &#39;/api/option-chain-indices?symbol={symbol}&#39;,
                                 &#39;option_cahin_equities&#39;: &#39;/api/option-chain-equities?symbol={symbol}&#39;,
                                 &#39;indices&#39;: &#39;/api/allIndices&#39;,
                                 &#39;indices_hist_base&#39;: &#34;https://www1.nseindia.com/products/dynaContent/equities/indices/historicalindices.jsp?indexType=&#34;,
                                 &#39;symbol_list&#39;: &#39;/api/equity-stockIndices?index={index}&#39;,
                                 &#39;fnoSymbols&#39;: &#34;/api/master-quote&#34;,
                                 &#39;gainer_loser&#39;: &#39;/api/equity-stockIndices?index=SECURITIES%20IN%20F%26O&#39;
                                 }
                        }

    def __init__(self):

        data_root = &#39;&#39;
        self.dir = {
            &#39;data_root&#39;: data_root,
            &#39;bhav_eq&#39;: f&#39;{data_root}bhavcopy_eq/&#39;,
            &#39;bhav_fno&#39;: f&#39;{data_root}bhavcopy_fno/&#39;,
            &#39;option_chain&#39;: f&#39;{data_root}option_chain/&#39;,
            &#39;symbol_list&#39;: f&#39;{data_root}symbol_list/&#39;,
            &#39;pre_open&#39;: f&#39;{data_root}pre_open/&#39;,
            &#39;hist&#39;: f&#39;{data_root}hist/&#39;,
            &#39;fii_dii&#39;: f&#39;{data_root}fii_dii/&#39;
        }
        self.__create_dir()

        self.expiry_list = []
        self.strike_list = []
        self.max_retries = 5
        self.timeout = 10
        self.headers = self.__generate_headers()

        symbol_files = {i.name: f&#34;{self.dir[&#39;symbol_list&#39;]}{i.name}.pkl&#34; for i in IndexSymbol}

        self.symbols = {&#39;All&#39;: [&#39;SBIN&#39;]}
        for i in IndexSymbol:
            if not os.path.exists(symbol_files[i.name]):
                for retry in range(5):
                    try:
                        self.__symbol_list(i)

                    except:
                        logger.info(f&#39;retrying symbol downloads for{i}&#39;)
                        time.sleep(5)
                    else:
                        with open(symbol_files[i.name], &#39;rb&#39;)as f:
                            self.symbols[i.name] = pickle.load(f)
                        break
            else:
                with open(symbol_files[i.name], &#39;rb&#39;)as f:
                    self.symbols[i.name] = pickle.load(f)

    def __get_resp(self, url, retries=0, timeout=5):
        retries = self.max_retries if retries == 0 else retries
        timeout = self.timeout if timeout == 0 else timeout

        for nrt in range(retries):
            try:
                response = requests.get(url, headers=self.headers, timeout=timeout)
            except Exception as e:
                logger.error(e)

                if nrt + 1 == retries:
                    raise ConnectionError()
                self.headers = self.__generate_headers()
                logger.debug(&#39;retrying&#39;)

                time.sleep(2)
            else:
                return response

    def __generate_headers(self):
        h = Headers(headers=True).generate()
        return h

    def __create_dir(self):
        if not os.path.exists(self.dir[&#39;symbol_list&#39;]):
            logger.debug(&#39;Create folders and downloading symbols. it may take some time&#39;)

        for _, path in self.dir.items():
            if path != &#39;&#39;:
                if not os.path.exists(path):
                    os.mkdir(path)

    @staticmethod
    def __validate_symbol(symbol, _list):

        symbol = symbol if isinstance(symbol, IndexSymbol) else symbol.upper()
        if isinstance(symbol, IndexSymbol):
            symbol = urllib.parse.quote(symbol.value)

            return symbol

        elif symbol in _list:
            symbol = urllib.parse.quote(symbol.upper())

            return symbol


        else:
            symbol = None
            raise ValueError(&#39;not a vaild symbol&#39;)

    def market_status(self) -&gt; dict:
        &#34;&#34;&#34;
        get market status

        Examples
        --------

        &gt;&gt;&gt; nse.market_status()

        &#34;&#34;&#34;
        config = self.__service_config
        logger.info(&#34;downloading market status&#34;)
        url = config[&#39;host&#39;] + config[&#39;path&#39;][&#39;marketStatus&#39;]

        return self.__get_resp(url=url).json()

    def info(self, symbol: str = &#39;SBIN&#39;) -&gt; dict:
        &#39;&#39;&#39;
        Get symbol information from nse

        Examples
        --------

        &gt;&gt;&gt; nse.info(&#39;SBIN&#39;)

        &#39;&#39;&#39;
        config = self.__service_config
        symbol = self.__validate_symbol(symbol, self.symbols[IndexSymbol.All.name])
        if symbol is not None:
            logger.info(f&#34;downloading symbol info for {symbol}&#34;)
            url = config[&#39;host&#39;] + config[&#39;path&#39;][&#39;info&#39;].format(symbol=symbol)

            return self.__get_resp(url=url).json()

    def get_quote(self,
                  symbol: str = &#39;HDFC&#39;,
                  segment: Segment = Segment.EQ,
                  expiry: dt.date = None,
                  optionType: OptionType = OptionType.CE,
                  strike: str = &#39;-&#39;) -&gt; dict:
        &#34;&#34;&#34;

        Get realtime quote for EQ, FUT and OPT

        if no expiry date is provided for derivatives, returns date for nearest expiry

        Examples
        --------
        for cash
        &gt;&gt;&gt; nse.get_quote(&#39;RELIANCE&#39;)

        for futures
        &gt;&gt;&gt; nse.get_quote(&#39;TCS&#39;, segment=Segment.FUT, expiry=dt.date( 2020, 6, 30 ))

        for options
        &gt;&gt;&gt; nse.get_quote(&#39;HDFC&#39;, segment=Segment.OPT, optionType=OptionType.PE)

        &#34;&#34;&#34;
        config = self.__service_config
        segment = segment.value
        optionType = optionType.value

        if symbol is not None:
            logger.info(f&#34;downloading quote for {symbol} {segment}&#34;)
            quote = {}
            if segment == &#39;EQ&#39;:
                symbol = self.__validate_symbol(symbol,
                                                self.symbols[IndexSymbol.All.name] + [idx.value for idx in IndexSymbol])

                url = config[&#39;host&#39;] + config[&#39;path&#39;][&#39;quote_eq&#39;].format(symbol=symbol)
                url1 = config[&#39;host&#39;] + config[&#39;path&#39;][&#39;trade_info&#39;].format(symbol=symbol)
                data = self.__get_resp(url).json()
                data.update(self.__get_resp(url1).json())
                quote = data[&#39;priceInfo&#39;]
                quote[&#39;timestamp&#39;] = dt.datetime.strptime(data[&#39;metadata&#39;][&#39;lastUpdateTime&#39;], &#39;%d-%b-%Y %H:%M:%S&#39;)
                quote.update(series=data[&#39;metadata&#39;][&#39;series&#39;])
                quote.update(symbol=data[&#39;metadata&#39;][&#39;symbol&#39;])
                quote.update(data[&#39;securityWiseDP&#39;])
                quote[&#39;low&#39;] = quote[&#39;intraDayHighLow&#39;][&#39;min&#39;]
                quote[&#39;high&#39;] = quote[&#39;intraDayHighLow&#39;][&#39;max&#39;]

            elif segment == &#39;FUT&#39;:
                symbol = self.__validate_symbol(symbol,
                                                self.symbols[IndexSymbol.FnO.name] + [&#39;NIFTY&#39;, &#39;BANKNIFTY&#39;])

                url = config[&#39;host&#39;] + config[&#39;path&#39;][&#39;quote_derivative&#39;].format(symbol=symbol)

                data = self.__get_resp(url).json()
                quote[&#39;timestamp&#39;] = dt.datetime.strptime(data[&#39;fut_timestamp&#39;], &#39;%d-%b-%Y %H:%M:%S&#39;)

                data = [
                    i for i in data[&#39;stocks&#39;]
                    if segment.lower() in i[&#39;metadata&#39;][&#39;instrumentType&#39;].lower()
                ]

                expiry_list = list(
                    dict.fromkeys([dt.datetime.strptime(i[&#39;metadata&#39;][&#39;expiryDate&#39;], &#39;%d-%b-%Y&#39;).date() for i in data]))

                if expiry is None:
                    expiry = expiry_list[0]

                data = [i for i in data if
                        dt.datetime.strptime(i[&#39;metadata&#39;][&#39;expiryDate&#39;], &#39;%d-%b-%Y&#39;).date() == expiry]

                quote.update(data[0][&#39;marketDeptOrderBook&#39;][&#39;tradeInfo&#39;])
                quote.update(data[0][&#39;metadata&#39;])
                quote[&#39;expiryDate&#39;] = dt.datetime.strptime(quote[&#39;expiryDate&#39;], &#39;%d-%b-%Y&#39;).date()

            elif segment == &#39;OPT&#39;:
                url = config[&#39;host&#39;] + config[&#39;path&#39;][&#39;quote_derivative&#39;].format(symbol=symbol)

                data = self.__get_resp(url).json()

                quote[&#39;timestamp&#39;] = dt.datetime.strptime(data[&#39;opt_timestamp&#39;], &#39;%d-%b-%Y %H:%M:%S&#39;)

                data = [
                    i for i in data[&#39;stocks&#39;]
                    if segment.lower() in i[&#39;metadata&#39;][&#39;instrumentType&#39;].lower()
                       and i[&#39;metadata&#39;][&#39;optionType&#39;] == optionType
                ]

                self.strike_list = list(dict.fromkeys(
                    [i[&#39;metadata&#39;][&#39;strikePrice&#39;] for i in data]))

                strike = strike if strike in self.strike_list else self.strike_list[0]

                self.expiry_list = list(
                    dict.fromkeys([dt.datetime.strptime(i[&#39;metadata&#39;][&#39;expiryDate&#39;], &#39;%d-%b-%Y&#39;).date() for i in data]))

                if expiry is None:
                    expiry = self.expiry_list[0]

                data = [i for i in data if
                        dt.datetime.strptime(i[&#39;metadata&#39;][&#39;expiryDate&#39;], &#39;%d-%b-%Y&#39;).date() == expiry and
                        i[&#39;metadata&#39;][&#39;strikePrice&#39;] == strike]
                quote.update(data[0][&#39;marketDeptOrderBook&#39;][&#39;tradeInfo&#39;])
                quote.update(data[0][&#39;marketDeptOrderBook&#39;][&#39;otherInfo&#39;])
                quote.update(data[0][&#39;metadata&#39;])
                quote[&#39;expiryDate&#39;] = dt.datetime.strptime(quote[&#39;expiryDate&#39;], &#39;%d-%b-%Y&#39;).date()

            return quote

    def bhavcopy(self, req_date: dt.date = None,
                 series: str = &#39;eq&#39;) -&gt; pd.DataFrame:
        &#34;&#34;&#34;
        download bhavcopy from nse
        or
        read bhavcopy if already downloaded

        Examples
        --------

        &gt;&gt;&gt; nse.bhavcopy()

        &gt;&gt;&gt; nse.bhavcopy(dt.date(2020,6,17))
        &#34;&#34;&#34;

        series = series.upper()
        req_date = self.___trading_days()[-1].date() if req_date is None else req_date

        filename = f&#39;{self.dir[&#34;bhav_eq&#34;]}bhav_{req_date}.pkl&#39;

        bhavcopy = None
        if os.path.exists(filename):
            bhavcopy = pd.read_pickle(filename)
            logger.debug(f&#39;read {filename} from disk&#39;)

        else:
            config = self.__service_config
            url = config[&#39;path&#39;][&#39;bhavcopy&#39;].format(date=req_date.strftime(&#34;%d%m%Y&#34;))
            csv = self.__get_resp(url).content.decode(&#39;utf8&#39;).replace(&#34; &#34;, &#34;&#34;)

            bhavcopy = pd.read_csv(io.StringIO(csv))
            bhavcopy[&#34;DATE1&#34;] = bhavcopy[&#34;DATE1&#34;].apply(lambda x: dt.datetime.strptime(x, &#39;%d-%b-%Y&#39;).date())

            bhavcopy.to_pickle(filename)

        if bhavcopy is not None:
            if series != &#39;ALL&#39;:
                bhavcopy = bhavcopy.loc[bhavcopy[&#39;SERIES&#39;] == series]

            bhavcopy.set_index([&#39;SYMBOL&#39;, &#39;SERIES&#39;], inplace=True)

        return bhavcopy

    def bhavcopy_fno(self, req_date: dt.date = None) -&gt; pd.DataFrame:
        &#34;&#34;&#34;
        download bhavcopy from nse
        or
        read bhavcopy if already downloaded

        Examples
        --------

        &gt;&gt;&gt; nse.bhavcopy_fno()

        &gt;&gt;&gt; nse.bhavcopy_fno(dt.date(2020,6,17))

        &#34;&#34;&#34;
        req_date = self.___trading_days()[-1].date() if req_date is None else req_date

        filename = f&#39;{self.dir[&#34;bhav_fno&#34;]}bhav_{req_date}.pkl&#39;

        bhavcopy = None
        if os.path.exists(filename):
            bhavcopy = pd.read_pickle(filename)
            logger.debug(f&#39;read {filename} from disk&#39;)

        else:
            config = self.__service_config
            url = config[&#39;path&#39;][&#39;bhavcopy_derivatives&#39;].format(date=req_date.strftime(&#34;%d%b%Y&#34;).upper(),
                                                                month=req_date.strftime(&#34;%b&#34;).upper(),
                                                                year=req_date.strftime(&#34;%Y&#34;))

            logger.debug(&#34;downloading bhavcopy for {}&#34;.format(req_date))
            stream = self.__get_resp(
                url).content

            filebytes = io.BytesIO(stream)
            zf = zipfile.ZipFile(filebytes)

            bhavcopy = pd.read_csv(zf.open(zf.namelist()[0]))

            bhavcopy.set_index(&#39;SYMBOL&#39;, inplace=True)
            bhavcopy.dropna(axis=1, inplace=True)
            bhavcopy.EXPIRY_DT = bhavcopy.EXPIRY_DT.apply(lambda x: dt.datetime.strptime(x, &#39;%d-%b-%Y&#39;))

            bhavcopy.to_pickle(filename)

        return bhavcopy

    def pre_open(self) -&gt; pd.DataFrame:
        &#34;&#34;&#34;

        get pre open data from nse

        Examples
        --------

        &gt;&gt;&gt; nse.pre_open()

        &#34;&#34;&#34;
        logger.debug(&#34;downloading preopen data&#34;)
        config = self.__service_config
        url = config[&#39;host&#39;] + config[&#39;path&#39;][&#39;preOpen&#39;]

        data = self.__get_resp(url).json()
        pre_open_data = pd.DataFrame([{
            &#34;symbol&#34;:
                i[&#34;metadata&#34;][&#34;symbol&#34;],
            &#34;preOpen&#34;:
                i[&#34;metadata&#34;][&#34;lastPrice&#34;],
            &#34;change&#34;:
                i[&#34;metadata&#34;][&#34;change&#34;],
            &#34;pChange&#34;:
                i[&#34;metadata&#34;][&#34;pChange&#34;],
            &#34;finalQuantity&#34;:
                i[&#34;metadata&#34;][&#34;finalQuantity&#34;],
            &#34;lastUpdateTime&#34;:
                i[&#34;detail&#34;][&#34;preOpenMarket&#34;][&#39;lastUpdateTime&#39;]
        } for i in data[&#34;data&#34;]])

        pre_open_data = pre_open_data.set_index(&#34;symbol&#34;)
        pre_open_data[&#34;lastUpdateTime&#34;] = pre_open_data[&#34;lastUpdateTime&#34;].apply(
            lambda x: dt.datetime.strptime(x, &#39;%d-%b-%Y %H:%M:%S&#39;))

        filename = f&#34;{self.dir[&#39;pre_open&#39;]}{pre_open_data[&#39;lastUpdateTime&#39;][-1].date()}.pkl&#34;
        pre_open_data.to_pickle(filename)

        return pre_open_data

    def __option_chain_download(self, symbol):
        symbol = self.__validate_symbol(symbol, self.symbols[IndexSymbol.FnO.name] + [&#39;NIFTY&#39;, &#39;BANKNIFTY&#39;, &#39;NIFTYIT&#39;])
        logger.debug(f&#39;download option chain&#39;)
        config = self.__service_config

        url = config[&#39;host&#39;] + (config[&#39;path&#39;][&#39;option_chain_index&#39;] if &#39;NIFTY&#39; in symbol else config[&#39;path&#39;][
            &#39;option_cahin_equities&#39;]).format(symbol=symbol)
        data = self.__get_resp(url).json()
        return data

    def __read_object(self, filename, format):
        if format == Format.pkl:
            with open(filename, &#39;rb&#39;)as f:
                obj = pickle.load(f)
            return obj
        elif format == Format.csv:
            with open(filename, &#39;r&#39;)as f:
                obj = f.read()
            return obj
        else:
            raise FileNotFoundError(f&#39;{filename} not found&#39;)

    def __save_object(self, obj, filename, format):
        if format == Format.pkl:
            with open(filename, &#39;wb&#39;)as f:
                pickle.dump(obj, f)
        elif format == Format.csv:
            with open(filename, &#39;w&#39;)as f:
                f.write(obj)
        logger.debug(f&#39;saved {filename}&#39;)

    def option_chain(self, symbol: str = &#39;NIFTY&#39;, req_date: dt.date = None) -&gt; dict:
        &#34;&#34;&#34;
        downloads the option chain
        or
        reads if already downloaded

        if no req_date is specified latest available option chain from nse website

        :returns dictonaly containing
            timestamp as str
            option chain as pd.Dataframe
            expiry_list as list

        Examples
        --------

        &gt;&gt;&gt; nse.option_chain(&#39;INFY&#39;)

        &gt;&gt;&gt; nse.option_chain(&#39;INFY&#39;,expiry=dt.date(2020,6,30))

        &#34;&#34;&#34;
        dir = f&#34;{self.dir[&#39;option_chain&#39;]}{symbol}/&#34;
        if not os.path.exists(dir):
            os.mkdir(dir)

        if req_date is None:
            q = self.get_quote(np.random.choice(self.symbols[&#39;FnO&#39;]))
            logger.debug(&#39;got timestamp&#39;)
            timestamp = q[&#39;timestamp&#39;] if q is not None else None

            if timestamp.date() == dt.date.today() and timestamp.time() &lt;= dt.time(15, 30):
                filename = f&#34;{dir}{dt.date.today()}_{dt.datetime.now().strftime(&#39;%H%M%S&#39;)}.pkl&#34;
                download_req = True

            elif timestamp.date() == dt.date.today():
                filename = f&#34;{dir}{dt.date.today()}_eod.pkl&#34;

                download_req = False if os.path.exists(filename) else True

            else:
                prev_trading_day = self.___trading_days()[-1].date()
                filename = f&#34;{dir}{prev_trading_day}_eod.pkl&#34;

                download_req = False if os.path.exists(filename) else True

        else:
            if req_date == dt.date.today():
                q = self.get_quote()

                timestamp = dt.datetime.strptime(self.get_quote()[&#39;timestamp&#39;],
                                                 &#34;%d-%b-%Y %H:%M:%S&#34;) if q is not None else None

                if timestamp.date() == dt.date.today() and timestamp.time() &lt;= dt.time(15, 30):
                    filename = f&#34;{dir}{req_date}_{dt.datetime.now().strftime(&#39;%H%M%S&#39;)}.pkl&#34;
                    download_req = True

                else:
                    filename = f&#34;{dir}{req_date}_eod.pkl&#34;
                    download_req = False if os.path.exists(filename) else True
            else:
                prev_trading_day = self.___trading_days()[-1]
                if req_date &gt;= prev_trading_day:
                    filename = f&#34;{dir}{prev_trading_day}_eod.pkl&#34;
                    download_req = False if os.path.exists(filename) else True
                else:
                    filename = f&#34;{dir}{req_date}_eod.pkl&#34;
                    download_req = False

        if download_req:
            data = self.__option_chain_download(symbol)
            self.__save_object(data, filename, Format.pkl)
        data = self.__read_object(filename, Format.pkl)
        expiry_list = data[&#39;records&#39;][&#39;expiryDates&#39;]
        option_chain = pd.json_normalize(data[&#39;records&#39;][&#39;data&#39;])
        timestamp = data[&#39;records&#39;][&#39;timestamp&#39;]
        return {&#39;timestamp&#39;: timestamp, &#39;data&#39;: option_chain, &#39;expiry_list&#39;: expiry_list}

    def fii_dii(self) -&gt; dict:
        &#34;&#34;&#34;
        get FII and DII data from nse

        Examples
        --------

        &gt;&gt;&gt; nse.fii_dii()

        &#34;&#34;&#34;
        config = self.__service_config
        url = config[&#39;host&#39;] + config[&#39;path&#39;][&#39;fii_dii&#39;]

        fii_file = f&#39;{self.dir[&#34;fii_dii&#34;]}fii.csv&#39;
        dii_file = f&#39;{self.dir[&#34;fii_dii&#34;]}dii.csv&#39;

        data = self.__get_resp(url).json()

        for i in range(len(data)):
            for k, v in data[i].items():
                try:
                    data[i][k] = float(v)
                except:
                    data[i][k] = v

        df = pd.DataFrame(data).set_index(&#39;date&#39;)

        df[df[&#39;category&#39;] == &#39;FII/FPI *&#39;].to_csv(fii_file, header=not os.path.exists(fii_file), mode=&#39;a+&#39;)
        df[df[&#39;category&#39;] == &#39;DII *&#39;].to_csv(dii_file, header=not os.path.exists(dii_file), mode=&#39;a+&#39;)

        return data

    def __get_hist(self, symbol=&#39;SBIN&#39;, from_date=None, to_date=None):
        config = self.__service_config

        max_date_range = 480

        if from_date == None:
            from_date = dt.date.today() - dt.timedelta(days=30)
        if to_date == None:
            to_date = dt.date.today()

        hist = pd.DataFrame()

        while True:
            if (to_date - from_date).days &gt; max_date_range:

                marker = from_date + dt.timedelta(max_date_range)
                url = config[&#39;host&#39;] + config[&#39;path&#39;][&#39;hist&#39;].format(symbol=symbol,
                                                                     from_date=from_date.strftime(&#39;%d-%m-%Y&#39;),
                                                                     to_date=marker.strftime(&#39;%d-%m-%Y&#39;))

                from_date = from_date + dt.timedelta(days=(max_date_range + 1))

                csv = self.__get_resp(url).content.decode(&#39;utf8&#39;).replace(&#34; &#34;, &#34;&#34;)
                is_complete = False

            else:
                url = config[&#39;host&#39;] + config[&#39;path&#39;][&#39;hist&#39;].format(symbol=symbol,
                                                                     from_date=from_date.strftime(&#39;%d-%m-%Y&#39;),
                                                                     to_date=to_date.strftime(&#39;%d-%m-%Y&#39;))

                from_date = from_date + dt.timedelta(max_date_range + 1)

                csv = self.__get_resp(url).content.decode(&#39;utf8&#39;).replace(&#34; &#34;, &#34;&#34;)
                is_complete = True

            hist = pd.concat([hist, pd.read_csv(io.StringIO(csv))[::-1]])
            if is_complete:
                break
            time.sleep(1)

        hist[&#39;Date&#39;] = pd.to_datetime(hist[&#39;Date&#39;])
        hist.set_index(&#39;Date&#39;, inplace=True)
        hist.drop([&#39;series&#39;, &#39;PREV.CLOSE&#39;, &#39;ltp&#39;, &#39;vwap&#39;, &#39;52WH&#39;, &#39;52WL&#39;, &#39;VALUE&#39;, &#39;Nooftrades&#39;], axis=1, inplace=True)
        try:
            hist.columns = [&#39;open&#39;, &#39;high&#39;, &#39;low&#39;, &#39;close&#39;, &#39;volume&#39;]
        except Exception as e:
            print(hist.columns, e)
            time.sleep(5)

        for column in hist.columns[:4]:
            hist[column] = hist[column].astype(str).str.replace(&#39;,&#39;, &#39;&#39;).replace(&#39;-&#39;, &#39;0&#39;).astype(float)
        hist[&#39;volume&#39;] = hist[&#39;volume&#39;].astype(int)
        return hist

    def __get_hist_index(self, symbol=&#39;NIFTY 50&#39;, from_date=None,
                         to_date=None):
        if from_date == None:
            from_date = dt.date.today() - dt.timedelta(days=30)
        if to_date == None:
            to_date = dt.date.today()

        config = self.__service_config
        base_url = config[&#39;path&#39;][&#39;indices_hist_base&#39;]

        urls = []
        max_range_len = 100
        while True:
            if (to_date - from_date).days &gt; max_range_len:
                s = from_date
                e = s + dt.timedelta(max_range_len)
                url = f&#34;{base_url}{symbol}&amp;fromDate={s.strftime(&#39;%d-%m-%Y&#39;)}&amp;toDate={e.strftime(&#39;%d-%m-%Y&#39;)}&#34;
                urls.append(url)
                from_date = from_date + dt.timedelta(max_range_len + 1)

            else:
                url = f&#34;{base_url}{symbol}&amp;fromDate={from_date.strftime(&#39;%d-%m-%Y&#39;)}&amp;toDate={to_date.strftime(&#39;%d-%m-%Y&#39;)}&#34;
                urls.append(url)

                break

        hist = pd.DataFrame(columns=[
            &#39;Date&#39;, &#39;Open&#39;, &#39;High&#39;, &#39;Low&#39;, &#39;Close&#39;, &#39;SharesTraded&#39;,
            &#39;Turnover(Cr)&#39;
        ])
        for url in urls:
            page = self.__get_resp(url).content.decode(&#39;utf-8&#39;)
            raw_table = BeautifulSoup(page, &#39;lxml&#39;).find_all(&#39;table&#39;)[0]

            rows = raw_table.find_all(&#39;tr&#39;)

            for row_no, row in enumerate(rows):

                if row_no &gt; 2:
                    _row = [
                        cell.get_text().replace(&#34; &#34;, &#34;&#34;).replace(&#34;,&#34;, &#34;&#34;)
                        for cell in row.find_all(&#39;td&#39;)
                    ]
                    if len(_row) &gt; 4:
                        hist.loc[len(hist)] = _row

            time.sleep(1)
        hist.Date = hist.Date.apply(lambda d: dt.datetime.strptime(d, &#39;%d-%b-%Y&#39;))

        hist.set_index(&#34;Date&#34;, inplace=True)

        for col in hist.columns:
            hist[col] = hist[col].astype(str).replace(&#39;,&#39;, &#39;&#39;).replace(&#39;-&#39;, &#39;0&#39;).astype(float)

        return hist

    def get_hist(self, symbol: str = &#39;SBIN&#39;, from_date: dt.date = None, to_date: dt.date = None) -&gt; pd.DataFrame:
        &#34;&#34;&#34;
        get historical data from nse
        symbol index or symbol

        Examples
        --------

        &gt;&gt;&gt; nse.get_hist(&#39;SBIN&#39;)

        &gt;&gt;&gt; nse.get_hist(&#39;NIFTY 50&#39;, from_date=dt.date(2020,1,1),to_date=dt.date(2020,6,26))


        &#34;&#34;&#34;
        symbol = self.__validate_symbol(symbol,
                                        self.symbols[IndexSymbol.All.name] + [idx.value for idx in IndexSymbol])

        if &#34;NIFTY&#34; in symbol:
            return self.__get_hist_index(symbol, from_date, to_date)
        else:
            return self.__get_hist(symbol, from_date, to_date)

    def get_indices(self, index: IndexSymbol = None) -&gt; pd.DataFrame:
        &#34;&#34;&#34;
        get realtime index value

        Examples
        --------

        &gt;&gt;&gt; nse.get_indices(IndexSymbol.NiftyInfra)
        &gt;&gt;&gt; nse.get_indices(IndexSymbol.Nifty50))

        &#34;&#34;&#34;

        self.__validate_symbol(index, [idx for idx in IndexSymbol])
        config = self.__service_config
        url = config[&#39;host&#39;] + config[&#39;path&#39;][&#39;indices&#39;]
        data = self.__get_resp(url).json()[&#39;data&#39;]

        data = pd.json_normalize(data).set_index(&#39;indexSymbol&#39;)
        if index is not None:
            data = data[data.index == index.value]

        data.drop([&#39;chart365dPath&#39;, &#39;chartTodayPath&#39;, &#39;chart30dPath&#39;], inplace=True, axis=1)
        return data

    def __gainers_losers(self, sort=0, length=10):

        config = self.__service_config
        url = config[&#39;host&#39;] + config[&#39;path&#39;][&#39;gainer_loser&#39;]
        data = self.__get_resp(url).json()

        table = pd.DataFrame(data[&#39;data&#39;])
        table.drop([
            &#39;chart30dPath&#39;, &#39;chart365dPath&#39;, &#39;chartTodayPath&#39;, &#39;meta&#39;,
            &#39;identifier&#39;, &#39;lastUpdateTime&#39;, &#39;yearHigh&#39;, &#39;yearLow&#39;, &#39;nearWKH&#39;,
            &#39;nearWKL&#39;, &#39;perChange365d&#39;, &#39;date365dAgo&#39;, &#39;date30dAgo&#39;,
            &#39;perChange30d&#39;
        ],
            axis=1,
            inplace=True)
        table.set_index(&#39;symbol&#39;, inplace=True)
        table.sort_values(by=[&#39;pChange&#39;],
                          axis=0,
                          ascending=False if sort == 0 else True,
                          inplace=True)
        return table.head(length)

    def top_gainers(self, length: int = 10) -&gt; pd.DataFrame:
        &#34;&#34;&#34;
        presently works only for SECURITIES IN F&amp;O

        Examples
        --------

        &gt;&gt;&gt; nse.top_gainers(10)

        &#34;&#34;&#34;
        return self.__gainers_losers(sort=0, length=length)

    def top_losers(self, length: int = 10) -&gt; pd.DataFrame:
        &#34;&#34;&#34;
        presently works only for SECURITIES IN F&amp;O

        Examples
        --------

        &gt;&gt;&gt; nse.top_losers(10)

        &#34;&#34;&#34;
        return self.__gainers_losers(sort=1, length=length)

    def __symbol_list(self, index: IndexSymbol):

        if not isinstance(index, IndexSymbol):
            raise TypeError(&#39;index is not of type &#34;Index&#34;&#39;)

        config = self.__service_config

        if index == IndexSymbol.All:
            data = list(self.bhavcopy().reset_index().SYMBOL)

        elif index == IndexSymbol.FnO:
            url = config[&#39;host&#39;] + config[&#39;path&#39;][&#39;fnoSymbols&#39;]
            data = self.__get_resp(url).json()

            data.extend([&#39;NIFTY&#39;, &#39;BANKNIFTY&#39;])

        else:

            url = config[&#39;host&#39;] + config[&#39;path&#39;][&#39;symbol_list&#39;].format(
                index=self.__validate_symbol(index, IndexSymbol))
            data = self.__get_resp(url).json()[&#39;data&#39;]
            data = [i[&#39;meta&#39;][&#39;symbol&#39;] for i in data if i[&#39;identifier&#39;] != index.value]

        data.sort()
        with open(self.dir[&#39;symbol_list&#39;] + index.name + &#39;.pkl&#39;, &#39;wb&#39;)as f:
            pickle.dump(data, f)
            logger.info(f&#39;symbol list saved for {index}&#39;)
        return data

    def update_symbol_list(self):
        &#34;&#34;&#34;
        Update list of symbols
        no need to run frequently
        required when constituent of an index is changed
        or
        list of securities in fno are updates
        :return: None

        Examples:

        &gt;&gt;&gt; nse.update_symbol_list()

        &#34;&#34;&#34;
        for i in [a for a in IndexSymbol]:
            self.__symbol_list(i)
            time.sleep(1)

    def ___trading_days(self):

        filename = f&#39;{self.dir[&#34;data_root&#34;]}/trading_days.csv&#39;

        if os.path.exists(filename):
            trading_days = pd.read_csv(filename, header=None)
            trading_days.columns = [&#39;Date&#39;]
            trading_days[&#39;Date&#39;] = trading_days[&#39;Date&#39;].apply(lambda x: dt.datetime.strptime(x, &#39;%Y-%m-%d&#39;))
            previous_trading_day = list(trading_days.tail(1)[&#39;Date&#39;])[0].date()

        else:
            previous_trading_day = dt.date.today() - dt.timedelta(days=100)
            trading_days = pd.DataFrame()

        if previous_trading_day == dt.date.today() or previous_trading_day == dt.date.today() - dt.timedelta(
                days=1) and dt.datetime.now().time() &lt;= dt.time(18, 45):
            pass

        else:
            _trading_days = self.get_hist(symbol=&#39;SBIN&#39;, from_date=previous_trading_day - dt.timedelta(7),
                                          to_date=dt.date.today()).reset_index()[[&#39;Date&#39;]]

            trading_days = pd.concat([trading_days, _trading_days]).drop_duplicates()
            trading_days.to_csv(filename, mode=&#39;w&#39;, index=False, header=False)

        trading_days = pd.read_csv(filename, header=None, index_col=0)
        trading_days.index = trading_days.index.map(lambda x: dt.datetime.strptime(x, &#34;%Y-%m-%d&#34;))

        return trading_days.index


if __name__ == &#34;__main__&#34;:
    pd.set_option(&#39;display.max_columns&#39;, None)
    nse = Nse()
    # pprint(nse.market_status())
    # pprint( nse.info(&#39;HDFC&#39;))
    # pprint(nse.get_quote(&#39;HDFC&#39;, segment=Segment.OPT, optionType=OptionType.PE))
    # pprint(nse.bhavcopy())
    # pprint(nse.bhavcopy_fno(dt.date(2020,6,17)))
    # pprint(nse.bhavcopy_fno())
    # pprint(nse.option_chain(&#39;HDFC&#39;))
    # pprint(nse.pre_open())
    # pprint(nse.fii_dii())
    # pprint(nse.get_hist(&#39;NIFTY 50&#39;))
    # pprint(nse.get_indices(IndexSymbol.NiftyInfra))
    # pprint(nse.top_gainers())
    # pprint(nse.top_losers())</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="pynse.pynse.Format"><code class="flex name class">
<span>class <span class="ident">Format</span></span>
<span>(</span><span>value, names=None, *, module=None, qualname=None, type=None, start=1)</span>
</code></dt>
<dd>
<div class="desc"><p>An enumeration.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class Format(enum.Enum):
    pkl = &#39;pkl&#39;
    csv = &#39;csv&#39;</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li>enum.Enum</li>
</ul>
<h3>Class variables</h3>
<dl>
<dt id="pynse.pynse.Format.csv"><code class="name">var <span class="ident">csv</span></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="pynse.pynse.Format.pkl"><code class="name">var <span class="ident">pkl</span></code></dt>
<dd>
<div class="desc"></div>
</dd>
</dl>
</dd>
<dt id="pynse.pynse.IndexSymbol"><code class="flex name class">
<span>class <span class="ident">IndexSymbol</span></span>
<span>(</span><span>value, names=None, *, module=None, qualname=None, type=None, start=1)</span>
</code></dt>
<dd>
<div class="desc"><p>An enumeration.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class IndexSymbol(enum.Enum):
    All = &#39;ALL&#39;
    FnO = &#39;FNO&#39;
    Nifty50 = &#39;NIFTY 50&#39;
    NiftyNext50 = &#39;NIFTY NEXT 50&#39;
    Nifty100 = &#39;NIFTY 100&#39;
    Nifty200 = &#39;NIFTY 200&#39;
    Nifty500 = &#39;NIFTY 500&#39;
    NiftyMidcap50 = &#39;NIFTY MIDCAP 50&#39;
    NiftyMidcap100 = &#39;NIFTY MIDCAP 100&#39;
    NiftySmlcap100 = &#39;NIFTY SMLCAP 100&#39;
    NiftyMidcap150 = &#39;NIFTY MIDCAP 150&#39;
    NiftySmlcap50 = &#39;NIFTY SMLCAP 50&#39;
    NiftySmlcap250 = &#39;NIFTY SMLCAP 250&#39;
    NiftyMidsml400 = &#39;NIFTY MIDSML 400&#39;
    NiftyBank = &#39;NIFTY BANK&#39;
    NiftyAuto = &#39;NIFTY AUTO&#39;
    NiftyFinService = &#39;NIFTY FIN SERVICE&#39;
    NiftyFmcg = &#39;NIFTY FMCG&#39;
    NiftyIt = &#39;NIFTY IT&#39;
    NiftyMedia = &#39;NIFTY MEDIA&#39;
    NiftyMetal = &#39;NIFTY METAL&#39;
    NiftyPharma = &#39;NIFTY PHARMA&#39;
    NiftyPsuBank = &#39;NIFTY PSU BANK&#39;
    NiftyPvtBank = &#39;NIFTY PVT BANK&#39;
    NiftyRealty = &#39;NIFTY REALTY&#39;
    Nifty50Value20 = &#39;NIFTY50 VALUE 20&#39;
    NiftyAlpha50 = &#39;NIFTY ALPHA 50&#39;
    Nifty50EqlWgt = &#39;NIFTY50 EQL WGT&#39;
    Nifty100EqlWgt = &#39;NIFTY100 EQL WGT&#39;
    Nifty100Lowvol30 = &#39;NIFTY100 LOWVOL30&#39;
    Nifty200Qualty30 = &#39;NIFTY200 QUALTY30&#39;
    NiftyCommodities = &#39;NIFTY COMMODITIES&#39;
    NiftyConsumption = &#39;NIFTY CONSUMPTION&#39;
    NiftyEnergy = &#39;NIFTY ENERGY&#39;
    NiftyInfra = &#39;NIFTY INFRA&#39;
    NiftyMnc = &#39;NIFTY MNC&#39;
    NiftyPse = &#39;NIFTY PSE&#39;
    NiftyServSector = &#39;NIFTY SERV SECTOR&#39;</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li>enum.Enum</li>
</ul>
<h3>Class variables</h3>
<dl>
<dt id="pynse.pynse.IndexSymbol.All"><code class="name">var <span class="ident">All</span></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="pynse.pynse.IndexSymbol.FnO"><code class="name">var <span class="ident">FnO</span></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="pynse.pynse.IndexSymbol.Nifty100"><code class="name">var <span class="ident">Nifty100</span></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="pynse.pynse.IndexSymbol.Nifty100EqlWgt"><code class="name">var <span class="ident">Nifty100EqlWgt</span></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="pynse.pynse.IndexSymbol.Nifty100Lowvol30"><code class="name">var <span class="ident">Nifty100Lowvol30</span></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="pynse.pynse.IndexSymbol.Nifty200"><code class="name">var <span class="ident">Nifty200</span></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="pynse.pynse.IndexSymbol.Nifty200Qualty30"><code class="name">var <span class="ident">Nifty200Qualty30</span></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="pynse.pynse.IndexSymbol.Nifty50"><code class="name">var <span class="ident">Nifty50</span></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="pynse.pynse.IndexSymbol.Nifty500"><code class="name">var <span class="ident">Nifty500</span></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="pynse.pynse.IndexSymbol.Nifty50EqlWgt"><code class="name">var <span class="ident">Nifty50EqlWgt</span></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="pynse.pynse.IndexSymbol.Nifty50Value20"><code class="name">var <span class="ident">Nifty50Value20</span></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="pynse.pynse.IndexSymbol.NiftyAlpha50"><code class="name">var <span class="ident">NiftyAlpha50</span></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="pynse.pynse.IndexSymbol.NiftyAuto"><code class="name">var <span class="ident">NiftyAuto</span></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="pynse.pynse.IndexSymbol.NiftyBank"><code class="name">var <span class="ident">NiftyBank</span></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="pynse.pynse.IndexSymbol.NiftyCommodities"><code class="name">var <span class="ident">NiftyCommodities</span></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="pynse.pynse.IndexSymbol.NiftyConsumption"><code class="name">var <span class="ident">NiftyConsumption</span></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="pynse.pynse.IndexSymbol.NiftyEnergy"><code class="name">var <span class="ident">NiftyEnergy</span></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="pynse.pynse.IndexSymbol.NiftyFinService"><code class="name">var <span class="ident">NiftyFinService</span></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="pynse.pynse.IndexSymbol.NiftyFmcg"><code class="name">var <span class="ident">NiftyFmcg</span></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="pynse.pynse.IndexSymbol.NiftyInfra"><code class="name">var <span class="ident">NiftyInfra</span></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="pynse.pynse.IndexSymbol.NiftyIt"><code class="name">var <span class="ident">NiftyIt</span></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="pynse.pynse.IndexSymbol.NiftyMedia"><code class="name">var <span class="ident">NiftyMedia</span></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="pynse.pynse.IndexSymbol.NiftyMetal"><code class="name">var <span class="ident">NiftyMetal</span></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="pynse.pynse.IndexSymbol.NiftyMidcap100"><code class="name">var <span class="ident">NiftyMidcap100</span></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="pynse.pynse.IndexSymbol.NiftyMidcap150"><code class="name">var <span class="ident">NiftyMidcap150</span></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="pynse.pynse.IndexSymbol.NiftyMidcap50"><code class="name">var <span class="ident">NiftyMidcap50</span></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="pynse.pynse.IndexSymbol.NiftyMidsml400"><code class="name">var <span class="ident">NiftyMidsml400</span></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="pynse.pynse.IndexSymbol.NiftyMnc"><code class="name">var <span class="ident">NiftyMnc</span></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="pynse.pynse.IndexSymbol.NiftyNext50"><code class="name">var <span class="ident">NiftyNext50</span></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="pynse.pynse.IndexSymbol.NiftyPharma"><code class="name">var <span class="ident">NiftyPharma</span></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="pynse.pynse.IndexSymbol.NiftyPse"><code class="name">var <span class="ident">NiftyPse</span></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="pynse.pynse.IndexSymbol.NiftyPsuBank"><code class="name">var <span class="ident">NiftyPsuBank</span></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="pynse.pynse.IndexSymbol.NiftyPvtBank"><code class="name">var <span class="ident">NiftyPvtBank</span></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="pynse.pynse.IndexSymbol.NiftyRealty"><code class="name">var <span class="ident">NiftyRealty</span></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="pynse.pynse.IndexSymbol.NiftyServSector"><code class="name">var <span class="ident">NiftyServSector</span></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="pynse.pynse.IndexSymbol.NiftySmlcap100"><code class="name">var <span class="ident">NiftySmlcap100</span></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="pynse.pynse.IndexSymbol.NiftySmlcap250"><code class="name">var <span class="ident">NiftySmlcap250</span></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="pynse.pynse.IndexSymbol.NiftySmlcap50"><code class="name">var <span class="ident">NiftySmlcap50</span></code></dt>
<dd>
<div class="desc"></div>
</dd>
</dl>
</dd>
<dt id="pynse.pynse.Nse"><code class="flex name class">
<span>class <span class="ident">Nse</span></span>
</code></dt>
<dd>
<div class="desc"><p>pynse is a library to extract realtime and historical data from NSE website</p>
<h2 id="examples">Examples</h2>
<pre><code class="python">&gt;&gt;&gt; from pynse import *
&gt;&gt;&gt; nse = Nse()
&gt;&gt;&gt; nse.market_status()
</code></pre></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class Nse:
    &#34;&#34;&#34;
    pynse is a library to extract realtime and historical data from NSE website

    Examples
    --------

    &gt;&gt;&gt; from pynse import *
    &gt;&gt;&gt; nse = Nse()
    &gt;&gt;&gt; nse.market_status()

    &#34;&#34;&#34;
    __service_config = {&#39;host&#39;: &#39;https://www.nseindia.com&#39;,
                        &#39;path&#39;: {&#39;marketStatus&#39;: &#39;/api/marketStatus&#39;,
                                 &#39;info&#39;: &#34;/api/equity-meta-info?symbol={symbol}&#34;,
                                 &#39;quote_eq&#39;: &#34;/api/quote-equity?symbol={symbol}&#34;,
                                 &#39;quote_derivative&#39;: &#34;/api/quote-derivative?symbol={symbol}&#34;,
                                 &#39;trade_info&#39;: &#34;/api/quote-equity?symbol={symbol}&amp;section=trade_info&#34;,
                                 &#39;hist&#39;: &#34;/api/historical/cm/equity?symbol={symbol}&amp;series=[%22EQ%22]&amp;from={from_date}&amp;to={to_date}&amp;csv=true&#34;,
                                 &#39;bhavcopy&#39;: &#39;https://archives.nseindia.com/products/content/sec_bhavdata_full_{date}.csv&#39;,
                                 &#39;bhavcopy_derivatives&#39;: &#39;https://archives.nseindia.com/content/historical/DERIVATIVES/{year}/{month}/fo{date}bhav.csv.zip&#39;,
                                 &#39;preOpen&#39;: &#34;/api/market-data-pre-open?key=ALL&#34;,
                                 &#39;fii_dii&#39;: &#34;/api/fiidiiTradeReact&#34;,
                                 &#39;option_chain_index&#39;: &#39;/api/option-chain-indices?symbol={symbol}&#39;,
                                 &#39;option_cahin_equities&#39;: &#39;/api/option-chain-equities?symbol={symbol}&#39;,
                                 &#39;indices&#39;: &#39;/api/allIndices&#39;,
                                 &#39;indices_hist_base&#39;: &#34;https://www1.nseindia.com/products/dynaContent/equities/indices/historicalindices.jsp?indexType=&#34;,
                                 &#39;symbol_list&#39;: &#39;/api/equity-stockIndices?index={index}&#39;,
                                 &#39;fnoSymbols&#39;: &#34;/api/master-quote&#34;,
                                 &#39;gainer_loser&#39;: &#39;/api/equity-stockIndices?index=SECURITIES%20IN%20F%26O&#39;
                                 }
                        }

    def __init__(self):

        data_root = &#39;&#39;
        self.dir = {
            &#39;data_root&#39;: data_root,
            &#39;bhav_eq&#39;: f&#39;{data_root}bhavcopy_eq/&#39;,
            &#39;bhav_fno&#39;: f&#39;{data_root}bhavcopy_fno/&#39;,
            &#39;option_chain&#39;: f&#39;{data_root}option_chain/&#39;,
            &#39;symbol_list&#39;: f&#39;{data_root}symbol_list/&#39;,
            &#39;pre_open&#39;: f&#39;{data_root}pre_open/&#39;,
            &#39;hist&#39;: f&#39;{data_root}hist/&#39;,
            &#39;fii_dii&#39;: f&#39;{data_root}fii_dii/&#39;
        }
        self.__create_dir()

        self.expiry_list = []
        self.strike_list = []
        self.max_retries = 5
        self.timeout = 10
        self.headers = self.__generate_headers()

        symbol_files = {i.name: f&#34;{self.dir[&#39;symbol_list&#39;]}{i.name}.pkl&#34; for i in IndexSymbol}

        self.symbols = {&#39;All&#39;: [&#39;SBIN&#39;]}
        for i in IndexSymbol:
            if not os.path.exists(symbol_files[i.name]):
                for retry in range(5):
                    try:
                        self.__symbol_list(i)

                    except:
                        logger.info(f&#39;retrying symbol downloads for{i}&#39;)
                        time.sleep(5)
                    else:
                        with open(symbol_files[i.name], &#39;rb&#39;)as f:
                            self.symbols[i.name] = pickle.load(f)
                        break
            else:
                with open(symbol_files[i.name], &#39;rb&#39;)as f:
                    self.symbols[i.name] = pickle.load(f)

    def __get_resp(self, url, retries=0, timeout=5):
        retries = self.max_retries if retries == 0 else retries
        timeout = self.timeout if timeout == 0 else timeout

        for nrt in range(retries):
            try:
                response = requests.get(url, headers=self.headers, timeout=timeout)
            except Exception as e:
                logger.error(e)

                if nrt + 1 == retries:
                    raise ConnectionError()
                self.headers = self.__generate_headers()
                logger.debug(&#39;retrying&#39;)

                time.sleep(2)
            else:
                return response

    def __generate_headers(self):
        h = Headers(headers=True).generate()
        return h

    def __create_dir(self):
        if not os.path.exists(self.dir[&#39;symbol_list&#39;]):
            logger.debug(&#39;Create folders and downloading symbols. it may take some time&#39;)

        for _, path in self.dir.items():
            if path != &#39;&#39;:
                if not os.path.exists(path):
                    os.mkdir(path)

    @staticmethod
    def __validate_symbol(symbol, _list):

        symbol = symbol if isinstance(symbol, IndexSymbol) else symbol.upper()
        if isinstance(symbol, IndexSymbol):
            symbol = urllib.parse.quote(symbol.value)

            return symbol

        elif symbol in _list:
            symbol = urllib.parse.quote(symbol.upper())

            return symbol


        else:
            symbol = None
            raise ValueError(&#39;not a vaild symbol&#39;)

    def market_status(self) -&gt; dict:
        &#34;&#34;&#34;
        get market status

        Examples
        --------

        &gt;&gt;&gt; nse.market_status()

        &#34;&#34;&#34;
        config = self.__service_config
        logger.info(&#34;downloading market status&#34;)
        url = config[&#39;host&#39;] + config[&#39;path&#39;][&#39;marketStatus&#39;]

        return self.__get_resp(url=url).json()

    def info(self, symbol: str = &#39;SBIN&#39;) -&gt; dict:
        &#39;&#39;&#39;
        Get symbol information from nse

        Examples
        --------

        &gt;&gt;&gt; nse.info(&#39;SBIN&#39;)

        &#39;&#39;&#39;
        config = self.__service_config
        symbol = self.__validate_symbol(symbol, self.symbols[IndexSymbol.All.name])
        if symbol is not None:
            logger.info(f&#34;downloading symbol info for {symbol}&#34;)
            url = config[&#39;host&#39;] + config[&#39;path&#39;][&#39;info&#39;].format(symbol=symbol)

            return self.__get_resp(url=url).json()

    def get_quote(self,
                  symbol: str = &#39;HDFC&#39;,
                  segment: Segment = Segment.EQ,
                  expiry: dt.date = None,
                  optionType: OptionType = OptionType.CE,
                  strike: str = &#39;-&#39;) -&gt; dict:
        &#34;&#34;&#34;

        Get realtime quote for EQ, FUT and OPT

        if no expiry date is provided for derivatives, returns date for nearest expiry

        Examples
        --------
        for cash
        &gt;&gt;&gt; nse.get_quote(&#39;RELIANCE&#39;)

        for futures
        &gt;&gt;&gt; nse.get_quote(&#39;TCS&#39;, segment=Segment.FUT, expiry=dt.date( 2020, 6, 30 ))

        for options
        &gt;&gt;&gt; nse.get_quote(&#39;HDFC&#39;, segment=Segment.OPT, optionType=OptionType.PE)

        &#34;&#34;&#34;
        config = self.__service_config
        segment = segment.value
        optionType = optionType.value

        if symbol is not None:
            logger.info(f&#34;downloading quote for {symbol} {segment}&#34;)
            quote = {}
            if segment == &#39;EQ&#39;:
                symbol = self.__validate_symbol(symbol,
                                                self.symbols[IndexSymbol.All.name] + [idx.value for idx in IndexSymbol])

                url = config[&#39;host&#39;] + config[&#39;path&#39;][&#39;quote_eq&#39;].format(symbol=symbol)
                url1 = config[&#39;host&#39;] + config[&#39;path&#39;][&#39;trade_info&#39;].format(symbol=symbol)
                data = self.__get_resp(url).json()
                data.update(self.__get_resp(url1).json())
                quote = data[&#39;priceInfo&#39;]
                quote[&#39;timestamp&#39;] = dt.datetime.strptime(data[&#39;metadata&#39;][&#39;lastUpdateTime&#39;], &#39;%d-%b-%Y %H:%M:%S&#39;)
                quote.update(series=data[&#39;metadata&#39;][&#39;series&#39;])
                quote.update(symbol=data[&#39;metadata&#39;][&#39;symbol&#39;])
                quote.update(data[&#39;securityWiseDP&#39;])
                quote[&#39;low&#39;] = quote[&#39;intraDayHighLow&#39;][&#39;min&#39;]
                quote[&#39;high&#39;] = quote[&#39;intraDayHighLow&#39;][&#39;max&#39;]

            elif segment == &#39;FUT&#39;:
                symbol = self.__validate_symbol(symbol,
                                                self.symbols[IndexSymbol.FnO.name] + [&#39;NIFTY&#39;, &#39;BANKNIFTY&#39;])

                url = config[&#39;host&#39;] + config[&#39;path&#39;][&#39;quote_derivative&#39;].format(symbol=symbol)

                data = self.__get_resp(url).json()
                quote[&#39;timestamp&#39;] = dt.datetime.strptime(data[&#39;fut_timestamp&#39;], &#39;%d-%b-%Y %H:%M:%S&#39;)

                data = [
                    i for i in data[&#39;stocks&#39;]
                    if segment.lower() in i[&#39;metadata&#39;][&#39;instrumentType&#39;].lower()
                ]

                expiry_list = list(
                    dict.fromkeys([dt.datetime.strptime(i[&#39;metadata&#39;][&#39;expiryDate&#39;], &#39;%d-%b-%Y&#39;).date() for i in data]))

                if expiry is None:
                    expiry = expiry_list[0]

                data = [i for i in data if
                        dt.datetime.strptime(i[&#39;metadata&#39;][&#39;expiryDate&#39;], &#39;%d-%b-%Y&#39;).date() == expiry]

                quote.update(data[0][&#39;marketDeptOrderBook&#39;][&#39;tradeInfo&#39;])
                quote.update(data[0][&#39;metadata&#39;])
                quote[&#39;expiryDate&#39;] = dt.datetime.strptime(quote[&#39;expiryDate&#39;], &#39;%d-%b-%Y&#39;).date()

            elif segment == &#39;OPT&#39;:
                url = config[&#39;host&#39;] + config[&#39;path&#39;][&#39;quote_derivative&#39;].format(symbol=symbol)

                data = self.__get_resp(url).json()

                quote[&#39;timestamp&#39;] = dt.datetime.strptime(data[&#39;opt_timestamp&#39;], &#39;%d-%b-%Y %H:%M:%S&#39;)

                data = [
                    i for i in data[&#39;stocks&#39;]
                    if segment.lower() in i[&#39;metadata&#39;][&#39;instrumentType&#39;].lower()
                       and i[&#39;metadata&#39;][&#39;optionType&#39;] == optionType
                ]

                self.strike_list = list(dict.fromkeys(
                    [i[&#39;metadata&#39;][&#39;strikePrice&#39;] for i in data]))

                strike = strike if strike in self.strike_list else self.strike_list[0]

                self.expiry_list = list(
                    dict.fromkeys([dt.datetime.strptime(i[&#39;metadata&#39;][&#39;expiryDate&#39;], &#39;%d-%b-%Y&#39;).date() for i in data]))

                if expiry is None:
                    expiry = self.expiry_list[0]

                data = [i for i in data if
                        dt.datetime.strptime(i[&#39;metadata&#39;][&#39;expiryDate&#39;], &#39;%d-%b-%Y&#39;).date() == expiry and
                        i[&#39;metadata&#39;][&#39;strikePrice&#39;] == strike]
                quote.update(data[0][&#39;marketDeptOrderBook&#39;][&#39;tradeInfo&#39;])
                quote.update(data[0][&#39;marketDeptOrderBook&#39;][&#39;otherInfo&#39;])
                quote.update(data[0][&#39;metadata&#39;])
                quote[&#39;expiryDate&#39;] = dt.datetime.strptime(quote[&#39;expiryDate&#39;], &#39;%d-%b-%Y&#39;).date()

            return quote

    def bhavcopy(self, req_date: dt.date = None,
                 series: str = &#39;eq&#39;) -&gt; pd.DataFrame:
        &#34;&#34;&#34;
        download bhavcopy from nse
        or
        read bhavcopy if already downloaded

        Examples
        --------

        &gt;&gt;&gt; nse.bhavcopy()

        &gt;&gt;&gt; nse.bhavcopy(dt.date(2020,6,17))
        &#34;&#34;&#34;

        series = series.upper()
        req_date = self.___trading_days()[-1].date() if req_date is None else req_date

        filename = f&#39;{self.dir[&#34;bhav_eq&#34;]}bhav_{req_date}.pkl&#39;

        bhavcopy = None
        if os.path.exists(filename):
            bhavcopy = pd.read_pickle(filename)
            logger.debug(f&#39;read {filename} from disk&#39;)

        else:
            config = self.__service_config
            url = config[&#39;path&#39;][&#39;bhavcopy&#39;].format(date=req_date.strftime(&#34;%d%m%Y&#34;))
            csv = self.__get_resp(url).content.decode(&#39;utf8&#39;).replace(&#34; &#34;, &#34;&#34;)

            bhavcopy = pd.read_csv(io.StringIO(csv))
            bhavcopy[&#34;DATE1&#34;] = bhavcopy[&#34;DATE1&#34;].apply(lambda x: dt.datetime.strptime(x, &#39;%d-%b-%Y&#39;).date())

            bhavcopy.to_pickle(filename)

        if bhavcopy is not None:
            if series != &#39;ALL&#39;:
                bhavcopy = bhavcopy.loc[bhavcopy[&#39;SERIES&#39;] == series]

            bhavcopy.set_index([&#39;SYMBOL&#39;, &#39;SERIES&#39;], inplace=True)

        return bhavcopy

    def bhavcopy_fno(self, req_date: dt.date = None) -&gt; pd.DataFrame:
        &#34;&#34;&#34;
        download bhavcopy from nse
        or
        read bhavcopy if already downloaded

        Examples
        --------

        &gt;&gt;&gt; nse.bhavcopy_fno()

        &gt;&gt;&gt; nse.bhavcopy_fno(dt.date(2020,6,17))

        &#34;&#34;&#34;
        req_date = self.___trading_days()[-1].date() if req_date is None else req_date

        filename = f&#39;{self.dir[&#34;bhav_fno&#34;]}bhav_{req_date}.pkl&#39;

        bhavcopy = None
        if os.path.exists(filename):
            bhavcopy = pd.read_pickle(filename)
            logger.debug(f&#39;read {filename} from disk&#39;)

        else:
            config = self.__service_config
            url = config[&#39;path&#39;][&#39;bhavcopy_derivatives&#39;].format(date=req_date.strftime(&#34;%d%b%Y&#34;).upper(),
                                                                month=req_date.strftime(&#34;%b&#34;).upper(),
                                                                year=req_date.strftime(&#34;%Y&#34;))

            logger.debug(&#34;downloading bhavcopy for {}&#34;.format(req_date))
            stream = self.__get_resp(
                url).content

            filebytes = io.BytesIO(stream)
            zf = zipfile.ZipFile(filebytes)

            bhavcopy = pd.read_csv(zf.open(zf.namelist()[0]))

            bhavcopy.set_index(&#39;SYMBOL&#39;, inplace=True)
            bhavcopy.dropna(axis=1, inplace=True)
            bhavcopy.EXPIRY_DT = bhavcopy.EXPIRY_DT.apply(lambda x: dt.datetime.strptime(x, &#39;%d-%b-%Y&#39;))

            bhavcopy.to_pickle(filename)

        return bhavcopy

    def pre_open(self) -&gt; pd.DataFrame:
        &#34;&#34;&#34;

        get pre open data from nse

        Examples
        --------

        &gt;&gt;&gt; nse.pre_open()

        &#34;&#34;&#34;
        logger.debug(&#34;downloading preopen data&#34;)
        config = self.__service_config
        url = config[&#39;host&#39;] + config[&#39;path&#39;][&#39;preOpen&#39;]

        data = self.__get_resp(url).json()
        pre_open_data = pd.DataFrame([{
            &#34;symbol&#34;:
                i[&#34;metadata&#34;][&#34;symbol&#34;],
            &#34;preOpen&#34;:
                i[&#34;metadata&#34;][&#34;lastPrice&#34;],
            &#34;change&#34;:
                i[&#34;metadata&#34;][&#34;change&#34;],
            &#34;pChange&#34;:
                i[&#34;metadata&#34;][&#34;pChange&#34;],
            &#34;finalQuantity&#34;:
                i[&#34;metadata&#34;][&#34;finalQuantity&#34;],
            &#34;lastUpdateTime&#34;:
                i[&#34;detail&#34;][&#34;preOpenMarket&#34;][&#39;lastUpdateTime&#39;]
        } for i in data[&#34;data&#34;]])

        pre_open_data = pre_open_data.set_index(&#34;symbol&#34;)
        pre_open_data[&#34;lastUpdateTime&#34;] = pre_open_data[&#34;lastUpdateTime&#34;].apply(
            lambda x: dt.datetime.strptime(x, &#39;%d-%b-%Y %H:%M:%S&#39;))

        filename = f&#34;{self.dir[&#39;pre_open&#39;]}{pre_open_data[&#39;lastUpdateTime&#39;][-1].date()}.pkl&#34;
        pre_open_data.to_pickle(filename)

        return pre_open_data

    def __option_chain_download(self, symbol):
        symbol = self.__validate_symbol(symbol, self.symbols[IndexSymbol.FnO.name] + [&#39;NIFTY&#39;, &#39;BANKNIFTY&#39;, &#39;NIFTYIT&#39;])
        logger.debug(f&#39;download option chain&#39;)
        config = self.__service_config

        url = config[&#39;host&#39;] + (config[&#39;path&#39;][&#39;option_chain_index&#39;] if &#39;NIFTY&#39; in symbol else config[&#39;path&#39;][
            &#39;option_cahin_equities&#39;]).format(symbol=symbol)
        data = self.__get_resp(url).json()
        return data

    def __read_object(self, filename, format):
        if format == Format.pkl:
            with open(filename, &#39;rb&#39;)as f:
                obj = pickle.load(f)
            return obj
        elif format == Format.csv:
            with open(filename, &#39;r&#39;)as f:
                obj = f.read()
            return obj
        else:
            raise FileNotFoundError(f&#39;{filename} not found&#39;)

    def __save_object(self, obj, filename, format):
        if format == Format.pkl:
            with open(filename, &#39;wb&#39;)as f:
                pickle.dump(obj, f)
        elif format == Format.csv:
            with open(filename, &#39;w&#39;)as f:
                f.write(obj)
        logger.debug(f&#39;saved {filename}&#39;)

    def option_chain(self, symbol: str = &#39;NIFTY&#39;, req_date: dt.date = None) -&gt; dict:
        &#34;&#34;&#34;
        downloads the option chain
        or
        reads if already downloaded

        if no req_date is specified latest available option chain from nse website

        :returns dictonaly containing
            timestamp as str
            option chain as pd.Dataframe
            expiry_list as list

        Examples
        --------

        &gt;&gt;&gt; nse.option_chain(&#39;INFY&#39;)

        &gt;&gt;&gt; nse.option_chain(&#39;INFY&#39;,expiry=dt.date(2020,6,30))

        &#34;&#34;&#34;
        dir = f&#34;{self.dir[&#39;option_chain&#39;]}{symbol}/&#34;
        if not os.path.exists(dir):
            os.mkdir(dir)

        if req_date is None:
            q = self.get_quote(np.random.choice(self.symbols[&#39;FnO&#39;]))
            logger.debug(&#39;got timestamp&#39;)
            timestamp = q[&#39;timestamp&#39;] if q is not None else None

            if timestamp.date() == dt.date.today() and timestamp.time() &lt;= dt.time(15, 30):
                filename = f&#34;{dir}{dt.date.today()}_{dt.datetime.now().strftime(&#39;%H%M%S&#39;)}.pkl&#34;
                download_req = True

            elif timestamp.date() == dt.date.today():
                filename = f&#34;{dir}{dt.date.today()}_eod.pkl&#34;

                download_req = False if os.path.exists(filename) else True

            else:
                prev_trading_day = self.___trading_days()[-1].date()
                filename = f&#34;{dir}{prev_trading_day}_eod.pkl&#34;

                download_req = False if os.path.exists(filename) else True

        else:
            if req_date == dt.date.today():
                q = self.get_quote()

                timestamp = dt.datetime.strptime(self.get_quote()[&#39;timestamp&#39;],
                                                 &#34;%d-%b-%Y %H:%M:%S&#34;) if q is not None else None

                if timestamp.date() == dt.date.today() and timestamp.time() &lt;= dt.time(15, 30):
                    filename = f&#34;{dir}{req_date}_{dt.datetime.now().strftime(&#39;%H%M%S&#39;)}.pkl&#34;
                    download_req = True

                else:
                    filename = f&#34;{dir}{req_date}_eod.pkl&#34;
                    download_req = False if os.path.exists(filename) else True
            else:
                prev_trading_day = self.___trading_days()[-1]
                if req_date &gt;= prev_trading_day:
                    filename = f&#34;{dir}{prev_trading_day}_eod.pkl&#34;
                    download_req = False if os.path.exists(filename) else True
                else:
                    filename = f&#34;{dir}{req_date}_eod.pkl&#34;
                    download_req = False

        if download_req:
            data = self.__option_chain_download(symbol)
            self.__save_object(data, filename, Format.pkl)
        data = self.__read_object(filename, Format.pkl)
        expiry_list = data[&#39;records&#39;][&#39;expiryDates&#39;]
        option_chain = pd.json_normalize(data[&#39;records&#39;][&#39;data&#39;])
        timestamp = data[&#39;records&#39;][&#39;timestamp&#39;]
        return {&#39;timestamp&#39;: timestamp, &#39;data&#39;: option_chain, &#39;expiry_list&#39;: expiry_list}

    def fii_dii(self) -&gt; dict:
        &#34;&#34;&#34;
        get FII and DII data from nse

        Examples
        --------

        &gt;&gt;&gt; nse.fii_dii()

        &#34;&#34;&#34;
        config = self.__service_config
        url = config[&#39;host&#39;] + config[&#39;path&#39;][&#39;fii_dii&#39;]

        fii_file = f&#39;{self.dir[&#34;fii_dii&#34;]}fii.csv&#39;
        dii_file = f&#39;{self.dir[&#34;fii_dii&#34;]}dii.csv&#39;

        data = self.__get_resp(url).json()

        for i in range(len(data)):
            for k, v in data[i].items():
                try:
                    data[i][k] = float(v)
                except:
                    data[i][k] = v

        df = pd.DataFrame(data).set_index(&#39;date&#39;)

        df[df[&#39;category&#39;] == &#39;FII/FPI *&#39;].to_csv(fii_file, header=not os.path.exists(fii_file), mode=&#39;a+&#39;)
        df[df[&#39;category&#39;] == &#39;DII *&#39;].to_csv(dii_file, header=not os.path.exists(dii_file), mode=&#39;a+&#39;)

        return data

    def __get_hist(self, symbol=&#39;SBIN&#39;, from_date=None, to_date=None):
        config = self.__service_config

        max_date_range = 480

        if from_date == None:
            from_date = dt.date.today() - dt.timedelta(days=30)
        if to_date == None:
            to_date = dt.date.today()

        hist = pd.DataFrame()

        while True:
            if (to_date - from_date).days &gt; max_date_range:

                marker = from_date + dt.timedelta(max_date_range)
                url = config[&#39;host&#39;] + config[&#39;path&#39;][&#39;hist&#39;].format(symbol=symbol,
                                                                     from_date=from_date.strftime(&#39;%d-%m-%Y&#39;),
                                                                     to_date=marker.strftime(&#39;%d-%m-%Y&#39;))

                from_date = from_date + dt.timedelta(days=(max_date_range + 1))

                csv = self.__get_resp(url).content.decode(&#39;utf8&#39;).replace(&#34; &#34;, &#34;&#34;)
                is_complete = False

            else:
                url = config[&#39;host&#39;] + config[&#39;path&#39;][&#39;hist&#39;].format(symbol=symbol,
                                                                     from_date=from_date.strftime(&#39;%d-%m-%Y&#39;),
                                                                     to_date=to_date.strftime(&#39;%d-%m-%Y&#39;))

                from_date = from_date + dt.timedelta(max_date_range + 1)

                csv = self.__get_resp(url).content.decode(&#39;utf8&#39;).replace(&#34; &#34;, &#34;&#34;)
                is_complete = True

            hist = pd.concat([hist, pd.read_csv(io.StringIO(csv))[::-1]])
            if is_complete:
                break
            time.sleep(1)

        hist[&#39;Date&#39;] = pd.to_datetime(hist[&#39;Date&#39;])
        hist.set_index(&#39;Date&#39;, inplace=True)
        hist.drop([&#39;series&#39;, &#39;PREV.CLOSE&#39;, &#39;ltp&#39;, &#39;vwap&#39;, &#39;52WH&#39;, &#39;52WL&#39;, &#39;VALUE&#39;, &#39;Nooftrades&#39;], axis=1, inplace=True)
        try:
            hist.columns = [&#39;open&#39;, &#39;high&#39;, &#39;low&#39;, &#39;close&#39;, &#39;volume&#39;]
        except Exception as e:
            print(hist.columns, e)
            time.sleep(5)

        for column in hist.columns[:4]:
            hist[column] = hist[column].astype(str).str.replace(&#39;,&#39;, &#39;&#39;).replace(&#39;-&#39;, &#39;0&#39;).astype(float)
        hist[&#39;volume&#39;] = hist[&#39;volume&#39;].astype(int)
        return hist

    def __get_hist_index(self, symbol=&#39;NIFTY 50&#39;, from_date=None,
                         to_date=None):
        if from_date == None:
            from_date = dt.date.today() - dt.timedelta(days=30)
        if to_date == None:
            to_date = dt.date.today()

        config = self.__service_config
        base_url = config[&#39;path&#39;][&#39;indices_hist_base&#39;]

        urls = []
        max_range_len = 100
        while True:
            if (to_date - from_date).days &gt; max_range_len:
                s = from_date
                e = s + dt.timedelta(max_range_len)
                url = f&#34;{base_url}{symbol}&amp;fromDate={s.strftime(&#39;%d-%m-%Y&#39;)}&amp;toDate={e.strftime(&#39;%d-%m-%Y&#39;)}&#34;
                urls.append(url)
                from_date = from_date + dt.timedelta(max_range_len + 1)

            else:
                url = f&#34;{base_url}{symbol}&amp;fromDate={from_date.strftime(&#39;%d-%m-%Y&#39;)}&amp;toDate={to_date.strftime(&#39;%d-%m-%Y&#39;)}&#34;
                urls.append(url)

                break

        hist = pd.DataFrame(columns=[
            &#39;Date&#39;, &#39;Open&#39;, &#39;High&#39;, &#39;Low&#39;, &#39;Close&#39;, &#39;SharesTraded&#39;,
            &#39;Turnover(Cr)&#39;
        ])
        for url in urls:
            page = self.__get_resp(url).content.decode(&#39;utf-8&#39;)
            raw_table = BeautifulSoup(page, &#39;lxml&#39;).find_all(&#39;table&#39;)[0]

            rows = raw_table.find_all(&#39;tr&#39;)

            for row_no, row in enumerate(rows):

                if row_no &gt; 2:
                    _row = [
                        cell.get_text().replace(&#34; &#34;, &#34;&#34;).replace(&#34;,&#34;, &#34;&#34;)
                        for cell in row.find_all(&#39;td&#39;)
                    ]
                    if len(_row) &gt; 4:
                        hist.loc[len(hist)] = _row

            time.sleep(1)
        hist.Date = hist.Date.apply(lambda d: dt.datetime.strptime(d, &#39;%d-%b-%Y&#39;))

        hist.set_index(&#34;Date&#34;, inplace=True)

        for col in hist.columns:
            hist[col] = hist[col].astype(str).replace(&#39;,&#39;, &#39;&#39;).replace(&#39;-&#39;, &#39;0&#39;).astype(float)

        return hist

    def get_hist(self, symbol: str = &#39;SBIN&#39;, from_date: dt.date = None, to_date: dt.date = None) -&gt; pd.DataFrame:
        &#34;&#34;&#34;
        get historical data from nse
        symbol index or symbol

        Examples
        --------

        &gt;&gt;&gt; nse.get_hist(&#39;SBIN&#39;)

        &gt;&gt;&gt; nse.get_hist(&#39;NIFTY 50&#39;, from_date=dt.date(2020,1,1),to_date=dt.date(2020,6,26))


        &#34;&#34;&#34;
        symbol = self.__validate_symbol(symbol,
                                        self.symbols[IndexSymbol.All.name] + [idx.value for idx in IndexSymbol])

        if &#34;NIFTY&#34; in symbol:
            return self.__get_hist_index(symbol, from_date, to_date)
        else:
            return self.__get_hist(symbol, from_date, to_date)

    def get_indices(self, index: IndexSymbol = None) -&gt; pd.DataFrame:
        &#34;&#34;&#34;
        get realtime index value

        Examples
        --------

        &gt;&gt;&gt; nse.get_indices(IndexSymbol.NiftyInfra)
        &gt;&gt;&gt; nse.get_indices(IndexSymbol.Nifty50))

        &#34;&#34;&#34;

        self.__validate_symbol(index, [idx for idx in IndexSymbol])
        config = self.__service_config
        url = config[&#39;host&#39;] + config[&#39;path&#39;][&#39;indices&#39;]
        data = self.__get_resp(url).json()[&#39;data&#39;]

        data = pd.json_normalize(data).set_index(&#39;indexSymbol&#39;)
        if index is not None:
            data = data[data.index == index.value]

        data.drop([&#39;chart365dPath&#39;, &#39;chartTodayPath&#39;, &#39;chart30dPath&#39;], inplace=True, axis=1)
        return data

    def __gainers_losers(self, sort=0, length=10):

        config = self.__service_config
        url = config[&#39;host&#39;] + config[&#39;path&#39;][&#39;gainer_loser&#39;]
        data = self.__get_resp(url).json()

        table = pd.DataFrame(data[&#39;data&#39;])
        table.drop([
            &#39;chart30dPath&#39;, &#39;chart365dPath&#39;, &#39;chartTodayPath&#39;, &#39;meta&#39;,
            &#39;identifier&#39;, &#39;lastUpdateTime&#39;, &#39;yearHigh&#39;, &#39;yearLow&#39;, &#39;nearWKH&#39;,
            &#39;nearWKL&#39;, &#39;perChange365d&#39;, &#39;date365dAgo&#39;, &#39;date30dAgo&#39;,
            &#39;perChange30d&#39;
        ],
            axis=1,
            inplace=True)
        table.set_index(&#39;symbol&#39;, inplace=True)
        table.sort_values(by=[&#39;pChange&#39;],
                          axis=0,
                          ascending=False if sort == 0 else True,
                          inplace=True)
        return table.head(length)

    def top_gainers(self, length: int = 10) -&gt; pd.DataFrame:
        &#34;&#34;&#34;
        presently works only for SECURITIES IN F&amp;O

        Examples
        --------

        &gt;&gt;&gt; nse.top_gainers(10)

        &#34;&#34;&#34;
        return self.__gainers_losers(sort=0, length=length)

    def top_losers(self, length: int = 10) -&gt; pd.DataFrame:
        &#34;&#34;&#34;
        presently works only for SECURITIES IN F&amp;O

        Examples
        --------

        &gt;&gt;&gt; nse.top_losers(10)

        &#34;&#34;&#34;
        return self.__gainers_losers(sort=1, length=length)

    def __symbol_list(self, index: IndexSymbol):

        if not isinstance(index, IndexSymbol):
            raise TypeError(&#39;index is not of type &#34;Index&#34;&#39;)

        config = self.__service_config

        if index == IndexSymbol.All:
            data = list(self.bhavcopy().reset_index().SYMBOL)

        elif index == IndexSymbol.FnO:
            url = config[&#39;host&#39;] + config[&#39;path&#39;][&#39;fnoSymbols&#39;]
            data = self.__get_resp(url).json()

            data.extend([&#39;NIFTY&#39;, &#39;BANKNIFTY&#39;])

        else:

            url = config[&#39;host&#39;] + config[&#39;path&#39;][&#39;symbol_list&#39;].format(
                index=self.__validate_symbol(index, IndexSymbol))
            data = self.__get_resp(url).json()[&#39;data&#39;]
            data = [i[&#39;meta&#39;][&#39;symbol&#39;] for i in data if i[&#39;identifier&#39;] != index.value]

        data.sort()
        with open(self.dir[&#39;symbol_list&#39;] + index.name + &#39;.pkl&#39;, &#39;wb&#39;)as f:
            pickle.dump(data, f)
            logger.info(f&#39;symbol list saved for {index}&#39;)
        return data

    def update_symbol_list(self):
        &#34;&#34;&#34;
        Update list of symbols
        no need to run frequently
        required when constituent of an index is changed
        or
        list of securities in fno are updates
        :return: None

        Examples:

        &gt;&gt;&gt; nse.update_symbol_list()

        &#34;&#34;&#34;
        for i in [a for a in IndexSymbol]:
            self.__symbol_list(i)
            time.sleep(1)

    def ___trading_days(self):

        filename = f&#39;{self.dir[&#34;data_root&#34;]}/trading_days.csv&#39;

        if os.path.exists(filename):
            trading_days = pd.read_csv(filename, header=None)
            trading_days.columns = [&#39;Date&#39;]
            trading_days[&#39;Date&#39;] = trading_days[&#39;Date&#39;].apply(lambda x: dt.datetime.strptime(x, &#39;%Y-%m-%d&#39;))
            previous_trading_day = list(trading_days.tail(1)[&#39;Date&#39;])[0].date()

        else:
            previous_trading_day = dt.date.today() - dt.timedelta(days=100)
            trading_days = pd.DataFrame()

        if previous_trading_day == dt.date.today() or previous_trading_day == dt.date.today() - dt.timedelta(
                days=1) and dt.datetime.now().time() &lt;= dt.time(18, 45):
            pass

        else:
            _trading_days = self.get_hist(symbol=&#39;SBIN&#39;, from_date=previous_trading_day - dt.timedelta(7),
                                          to_date=dt.date.today()).reset_index()[[&#39;Date&#39;]]

            trading_days = pd.concat([trading_days, _trading_days]).drop_duplicates()
            trading_days.to_csv(filename, mode=&#39;w&#39;, index=False, header=False)

        trading_days = pd.read_csv(filename, header=None, index_col=0)
        trading_days.index = trading_days.index.map(lambda x: dt.datetime.strptime(x, &#34;%Y-%m-%d&#34;))

        return trading_days.index</code></pre>
</details>
<h3>Methods</h3>
<dl>
<dt id="pynse.pynse.Nse.bhavcopy"><code class="name flex">
<span>def <span class="ident">bhavcopy</span></span>(<span>self, req_date:datetime.date=None, series:str='eq') >pandas.core.frame.DataFrame</span>
</code></dt>
<dd>
<div class="desc"><p>download bhavcopy from nse
or
read bhavcopy if already downloaded</p>
<h2 id="examples">Examples</h2>
<pre><code class="python">&gt;&gt;&gt; nse.bhavcopy()
</code></pre>
<pre><code class="python">&gt;&gt;&gt; nse.bhavcopy(dt.date(2020,6,17))
</code></pre></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def bhavcopy(self, req_date: dt.date = None,
             series: str = &#39;eq&#39;) -&gt; pd.DataFrame:
    &#34;&#34;&#34;
    download bhavcopy from nse
    or
    read bhavcopy if already downloaded

    Examples
    --------

    &gt;&gt;&gt; nse.bhavcopy()

    &gt;&gt;&gt; nse.bhavcopy(dt.date(2020,6,17))
    &#34;&#34;&#34;

    series = series.upper()
    req_date = self.___trading_days()[-1].date() if req_date is None else req_date

    filename = f&#39;{self.dir[&#34;bhav_eq&#34;]}bhav_{req_date}.pkl&#39;

    bhavcopy = None
    if os.path.exists(filename):
        bhavcopy = pd.read_pickle(filename)
        logger.debug(f&#39;read {filename} from disk&#39;)

    else:
        config = self.__service_config
        url = config[&#39;path&#39;][&#39;bhavcopy&#39;].format(date=req_date.strftime(&#34;%d%m%Y&#34;))
        csv = self.__get_resp(url).content.decode(&#39;utf8&#39;).replace(&#34; &#34;, &#34;&#34;)

        bhavcopy = pd.read_csv(io.StringIO(csv))
        bhavcopy[&#34;DATE1&#34;] = bhavcopy[&#34;DATE1&#34;].apply(lambda x: dt.datetime.strptime(x, &#39;%d-%b-%Y&#39;).date())

        bhavcopy.to_pickle(filename)

    if bhavcopy is not None:
        if series != &#39;ALL&#39;:
            bhavcopy = bhavcopy.loc[bhavcopy[&#39;SERIES&#39;] == series]

        bhavcopy.set_index([&#39;SYMBOL&#39;, &#39;SERIES&#39;], inplace=True)

    return bhavcopy</code></pre>
</details>
</dd>
<dt id="pynse.pynse.Nse.bhavcopy_fno"><code class="name flex">
<span>def <span class="ident">bhavcopy_fno</span></span>(<span>self, req_date:datetime.date=None) >pandas.core.frame.DataFrame</span>
</code></dt>
<dd>
<div class="desc"><p>download bhavcopy from nse
or
read bhavcopy if already downloaded</p>
<h2 id="examples">Examples</h2>
<pre><code class="python">&gt;&gt;&gt; nse.bhavcopy_fno()
</code></pre>
<pre><code class="python">&gt;&gt;&gt; nse.bhavcopy_fno(dt.date(2020,6,17))
</code></pre></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def bhavcopy_fno(self, req_date: dt.date = None) -&gt; pd.DataFrame:
    &#34;&#34;&#34;
    download bhavcopy from nse
    or
    read bhavcopy if already downloaded

    Examples
    --------

    &gt;&gt;&gt; nse.bhavcopy_fno()

    &gt;&gt;&gt; nse.bhavcopy_fno(dt.date(2020,6,17))

    &#34;&#34;&#34;
    req_date = self.___trading_days()[-1].date() if req_date is None else req_date

    filename = f&#39;{self.dir[&#34;bhav_fno&#34;]}bhav_{req_date}.pkl&#39;

    bhavcopy = None
    if os.path.exists(filename):
        bhavcopy = pd.read_pickle(filename)
        logger.debug(f&#39;read {filename} from disk&#39;)

    else:
        config = self.__service_config
        url = config[&#39;path&#39;][&#39;bhavcopy_derivatives&#39;].format(date=req_date.strftime(&#34;%d%b%Y&#34;).upper(),
                                                            month=req_date.strftime(&#34;%b&#34;).upper(),
                                                            year=req_date.strftime(&#34;%Y&#34;))

        logger.debug(&#34;downloading bhavcopy for {}&#34;.format(req_date))
        stream = self.__get_resp(
            url).content

        filebytes = io.BytesIO(stream)
        zf = zipfile.ZipFile(filebytes)

        bhavcopy = pd.read_csv(zf.open(zf.namelist()[0]))

        bhavcopy.set_index(&#39;SYMBOL&#39;, inplace=True)
        bhavcopy.dropna(axis=1, inplace=True)
        bhavcopy.EXPIRY_DT = bhavcopy.EXPIRY_DT.apply(lambda x: dt.datetime.strptime(x, &#39;%d-%b-%Y&#39;))

        bhavcopy.to_pickle(filename)

    return bhavcopy</code></pre>
</details>
</dd>
<dt id="pynse.pynse.Nse.fii_dii"><code class="name flex">
<span>def <span class="ident">fii_dii</span></span>(<span>self) >dict</span>
</code></dt>
<dd>
<div class="desc"><p>get FII and DII data from nse</p>
<h2 id="examples">Examples</h2>
<pre><code class="python">&gt;&gt;&gt; nse.fii_dii()
</code></pre></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def fii_dii(self) -&gt; dict:
    &#34;&#34;&#34;
    get FII and DII data from nse

    Examples
    --------

    &gt;&gt;&gt; nse.fii_dii()

    &#34;&#34;&#34;
    config = self.__service_config
    url = config[&#39;host&#39;] + config[&#39;path&#39;][&#39;fii_dii&#39;]

    fii_file = f&#39;{self.dir[&#34;fii_dii&#34;]}fii.csv&#39;
    dii_file = f&#39;{self.dir[&#34;fii_dii&#34;]}dii.csv&#39;

    data = self.__get_resp(url).json()

    for i in range(len(data)):
        for k, v in data[i].items():
            try:
                data[i][k] = float(v)
            except:
                data[i][k] = v

    df = pd.DataFrame(data).set_index(&#39;date&#39;)

    df[df[&#39;category&#39;] == &#39;FII/FPI *&#39;].to_csv(fii_file, header=not os.path.exists(fii_file), mode=&#39;a+&#39;)
    df[df[&#39;category&#39;] == &#39;DII *&#39;].to_csv(dii_file, header=not os.path.exists(dii_file), mode=&#39;a+&#39;)

    return data</code></pre>
</details>
</dd>
<dt id="pynse.pynse.Nse.get_hist"><code class="name flex">
<span>def <span class="ident">get_hist</span></span>(<span>self, symbol:str='SBIN', from_date:datetime.date=None, to_date:datetime.date=None) >pandas.core.frame.DataFrame</span>
</code></dt>
<dd>
<div class="desc"><p>get historical data from nse
symbol index or symbol</p>
<h2 id="examples">Examples</h2>
<pre><code class="python">&gt;&gt;&gt; nse.get_hist('SBIN')
</code></pre>
<pre><code class="python">&gt;&gt;&gt; nse.get_hist('NIFTY 50', from_date=dt.date(2020,1,1),to_date=dt.date(2020,6,26))
</code></pre></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_hist(self, symbol: str = &#39;SBIN&#39;, from_date: dt.date = None, to_date: dt.date = None) -&gt; pd.DataFrame:
    &#34;&#34;&#34;
    get historical data from nse
    symbol index or symbol

    Examples
    --------

    &gt;&gt;&gt; nse.get_hist(&#39;SBIN&#39;)

    &gt;&gt;&gt; nse.get_hist(&#39;NIFTY 50&#39;, from_date=dt.date(2020,1,1),to_date=dt.date(2020,6,26))


    &#34;&#34;&#34;
    symbol = self.__validate_symbol(symbol,
                                    self.symbols[IndexSymbol.All.name] + [idx.value for idx in IndexSymbol])

    if &#34;NIFTY&#34; in symbol:
        return self.__get_hist_index(symbol, from_date, to_date)
    else:
        return self.__get_hist(symbol, from_date, to_date)</code></pre>
</details>
</dd>
<dt id="pynse.pynse.Nse.get_indices"><code class="name flex">
<span>def <span class="ident">get_indices</span></span>(<span>self, index:<a title="pynse.pynse.IndexSymbol" href="#pynse.pynse.IndexSymbol">IndexSymbol</a>=None) >pandas.core.frame.DataFrame</span>
</code></dt>
<dd>
<div class="desc"><p>get realtime index value</p>
<h2 id="examples">Examples</h2>
<pre><code class="python">&gt;&gt;&gt; nse.get_indices(IndexSymbol.NiftyInfra)
&gt;&gt;&gt; nse.get_indices(IndexSymbol.Nifty50))
</code></pre></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_indices(self, index: IndexSymbol = None) -&gt; pd.DataFrame:
    &#34;&#34;&#34;
    get realtime index value

    Examples
    --------

    &gt;&gt;&gt; nse.get_indices(IndexSymbol.NiftyInfra)
    &gt;&gt;&gt; nse.get_indices(IndexSymbol.Nifty50))

    &#34;&#34;&#34;

    self.__validate_symbol(index, [idx for idx in IndexSymbol])
    config = self.__service_config
    url = config[&#39;host&#39;] + config[&#39;path&#39;][&#39;indices&#39;]
    data = self.__get_resp(url).json()[&#39;data&#39;]

    data = pd.json_normalize(data).set_index(&#39;indexSymbol&#39;)
    if index is not None:
        data = data[data.index == index.value]

    data.drop([&#39;chart365dPath&#39;, &#39;chartTodayPath&#39;, &#39;chart30dPath&#39;], inplace=True, axis=1)
    return data</code></pre>
</details>
</dd>
<dt id="pynse.pynse.Nse.get_quote"><code class="name flex">
<span>def <span class="ident">get_quote</span></span>(<span>self, symbol:str='HDFC', segment:<a title="pynse.pynse.Segment" href="#pynse.pynse.Segment">Segment</a>=Segment.EQ, expiry:datetime.date=None, optionType:<a title="pynse.pynse.OptionType" href="#pynse.pynse.OptionType">OptionType</a>=OptionType.CE, strike:str='-') >dict</span>
</code></dt>
<dd>
<div class="desc"><p>Get realtime quote for EQ, FUT and OPT</p>
<p>if no expiry date is provided for derivatives, returns date for nearest expiry</p>
<h2 id="examples">Examples</h2>
<p>for cash</p>
<pre><code class="python">&gt;&gt;&gt; nse.get_quote('RELIANCE')
</code></pre>
<p>for futures</p>
<pre><code class="python">&gt;&gt;&gt; nse.get_quote('TCS', segment=Segment.FUT, expiry=dt.date( 2020, 6, 30 ))
</code></pre>
<p>for options</p>
<pre><code class="python">&gt;&gt;&gt; nse.get_quote('HDFC', segment=Segment.OPT, optionType=OptionType.PE)
</code></pre></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_quote(self,
              symbol: str = &#39;HDFC&#39;,
              segment: Segment = Segment.EQ,
              expiry: dt.date = None,
              optionType: OptionType = OptionType.CE,
              strike: str = &#39;-&#39;) -&gt; dict:
    &#34;&#34;&#34;

    Get realtime quote for EQ, FUT and OPT

    if no expiry date is provided for derivatives, returns date for nearest expiry

    Examples
    --------
    for cash
    &gt;&gt;&gt; nse.get_quote(&#39;RELIANCE&#39;)

    for futures
    &gt;&gt;&gt; nse.get_quote(&#39;TCS&#39;, segment=Segment.FUT, expiry=dt.date( 2020, 6, 30 ))

    for options
    &gt;&gt;&gt; nse.get_quote(&#39;HDFC&#39;, segment=Segment.OPT, optionType=OptionType.PE)

    &#34;&#34;&#34;
    config = self.__service_config
    segment = segment.value
    optionType = optionType.value

    if symbol is not None:
        logger.info(f&#34;downloading quote for {symbol} {segment}&#34;)
        quote = {}
        if segment == &#39;EQ&#39;:
            symbol = self.__validate_symbol(symbol,
                                            self.symbols[IndexSymbol.All.name] + [idx.value for idx in IndexSymbol])

            url = config[&#39;host&#39;] + config[&#39;path&#39;][&#39;quote_eq&#39;].format(symbol=symbol)
            url1 = config[&#39;host&#39;] + config[&#39;path&#39;][&#39;trade_info&#39;].format(symbol=symbol)
            data = self.__get_resp(url).json()
            data.update(self.__get_resp(url1).json())
            quote = data[&#39;priceInfo&#39;]
            quote[&#39;timestamp&#39;] = dt.datetime.strptime(data[&#39;metadata&#39;][&#39;lastUpdateTime&#39;], &#39;%d-%b-%Y %H:%M:%S&#39;)
            quote.update(series=data[&#39;metadata&#39;][&#39;series&#39;])
            quote.update(symbol=data[&#39;metadata&#39;][&#39;symbol&#39;])
            quote.update(data[&#39;securityWiseDP&#39;])
            quote[&#39;low&#39;] = quote[&#39;intraDayHighLow&#39;][&#39;min&#39;]
            quote[&#39;high&#39;] = quote[&#39;intraDayHighLow&#39;][&#39;max&#39;]

        elif segment == &#39;FUT&#39;:
            symbol = self.__validate_symbol(symbol,
                                            self.symbols[IndexSymbol.FnO.name] + [&#39;NIFTY&#39;, &#39;BANKNIFTY&#39;])

            url = config[&#39;host&#39;] + config[&#39;path&#39;][&#39;quote_derivative&#39;].format(symbol=symbol)

            data = self.__get_resp(url).json()
            quote[&#39;timestamp&#39;] = dt.datetime.strptime(data[&#39;fut_timestamp&#39;], &#39;%d-%b-%Y %H:%M:%S&#39;)

            data = [
                i for i in data[&#39;stocks&#39;]
                if segment.lower() in i[&#39;metadata&#39;][&#39;instrumentType&#39;].lower()
            ]

            expiry_list = list(
                dict.fromkeys([dt.datetime.strptime(i[&#39;metadata&#39;][&#39;expiryDate&#39;], &#39;%d-%b-%Y&#39;).date() for i in data]))

            if expiry is None:
                expiry = expiry_list[0]

            data = [i for i in data if
                    dt.datetime.strptime(i[&#39;metadata&#39;][&#39;expiryDate&#39;], &#39;%d-%b-%Y&#39;).date() == expiry]

            quote.update(data[0][&#39;marketDeptOrderBook&#39;][&#39;tradeInfo&#39;])
            quote.update(data[0][&#39;metadata&#39;])
            quote[&#39;expiryDate&#39;] = dt.datetime.strptime(quote[&#39;expiryDate&#39;], &#39;%d-%b-%Y&#39;).date()

        elif segment == &#39;OPT&#39;:
            url = config[&#39;host&#39;] + config[&#39;path&#39;][&#39;quote_derivative&#39;].format(symbol=symbol)

            data = self.__get_resp(url).json()

            quote[&#39;timestamp&#39;] = dt.datetime.strptime(data[&#39;opt_timestamp&#39;], &#39;%d-%b-%Y %H:%M:%S&#39;)

            data = [
                i for i in data[&#39;stocks&#39;]
                if segment.lower() in i[&#39;metadata&#39;][&#39;instrumentType&#39;].lower()
                   and i[&#39;metadata&#39;][&#39;optionType&#39;] == optionType
            ]

            self.strike_list = list(dict.fromkeys(
                [i[&#39;metadata&#39;][&#39;strikePrice&#39;] for i in data]))

            strike = strike if strike in self.strike_list else self.strike_list[0]

            self.expiry_list = list(
                dict.fromkeys([dt.datetime.strptime(i[&#39;metadata&#39;][&#39;expiryDate&#39;], &#39;%d-%b-%Y&#39;).date() for i in data]))

            if expiry is None:
                expiry = self.expiry_list[0]

            data = [i for i in data if
                    dt.datetime.strptime(i[&#39;metadata&#39;][&#39;expiryDate&#39;], &#39;%d-%b-%Y&#39;).date() == expiry and
                    i[&#39;metadata&#39;][&#39;strikePrice&#39;] == strike]
            quote.update(data[0][&#39;marketDeptOrderBook&#39;][&#39;tradeInfo&#39;])
            quote.update(data[0][&#39;marketDeptOrderBook&#39;][&#39;otherInfo&#39;])
            quote.update(data[0][&#39;metadata&#39;])
            quote[&#39;expiryDate&#39;] = dt.datetime.strptime(quote[&#39;expiryDate&#39;], &#39;%d-%b-%Y&#39;).date()

        return quote</code></pre>
</details>
</dd>
<dt id="pynse.pynse.Nse.info"><code class="name flex">
<span>def <span class="ident">info</span></span>(<span>self, symbol:str='SBIN') >dict</span>
</code></dt>
<dd>
<div class="desc"><p>Get symbol information from nse</p>
<h2 id="examples">Examples</h2>
<pre><code class="python">&gt;&gt;&gt; nse.info('SBIN')
</code></pre></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def info(self, symbol: str = &#39;SBIN&#39;) -&gt; dict:
    &#39;&#39;&#39;
    Get symbol information from nse

    Examples
    --------

    &gt;&gt;&gt; nse.info(&#39;SBIN&#39;)

    &#39;&#39;&#39;
    config = self.__service_config
    symbol = self.__validate_symbol(symbol, self.symbols[IndexSymbol.All.name])
    if symbol is not None:
        logger.info(f&#34;downloading symbol info for {symbol}&#34;)
        url = config[&#39;host&#39;] + config[&#39;path&#39;][&#39;info&#39;].format(symbol=symbol)

        return self.__get_resp(url=url).json()</code></pre>
</details>
</dd>
<dt id="pynse.pynse.Nse.market_status"><code class="name flex">
<span>def <span class="ident">market_status</span></span>(<span>self) >dict</span>
</code></dt>
<dd>
<div class="desc"><p>get market status</p>
<h2 id="examples">Examples</h2>
<pre><code class="python">&gt;&gt;&gt; nse.market_status()
</code></pre></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def market_status(self) -&gt; dict:
    &#34;&#34;&#34;
    get market status

    Examples
    --------

    &gt;&gt;&gt; nse.market_status()

    &#34;&#34;&#34;
    config = self.__service_config
    logger.info(&#34;downloading market status&#34;)
    url = config[&#39;host&#39;] + config[&#39;path&#39;][&#39;marketStatus&#39;]

    return self.__get_resp(url=url).json()</code></pre>
</details>
</dd>
<dt id="pynse.pynse.Nse.option_chain"><code class="name flex">
<span>def <span class="ident">option_chain</span></span>(<span>self, symbol:str='NIFTY', req_date:datetime.date=None) >dict</span>
</code></dt>
<dd>
<div class="desc"><p>downloads the option chain
or
reads if already downloaded</p>
<p>if no req_date is specified latest available option chain from nse website</p>
<p>:returns dictonaly containing
timestamp as str
option chain as pd.Dataframe
expiry_list as list</p>
<h2 id="examples">Examples</h2>
<pre><code class="python">&gt;&gt;&gt; nse.option_chain('INFY')
</code></pre>
<pre><code class="python">&gt;&gt;&gt; nse.option_chain('INFY',expiry=dt.date(2020,6,30))
</code></pre></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def option_chain(self, symbol: str = &#39;NIFTY&#39;, req_date: dt.date = None) -&gt; dict:
    &#34;&#34;&#34;
    downloads the option chain
    or
    reads if already downloaded

    if no req_date is specified latest available option chain from nse website

    :returns dictonaly containing
        timestamp as str
        option chain as pd.Dataframe
        expiry_list as list

    Examples
    --------

    &gt;&gt;&gt; nse.option_chain(&#39;INFY&#39;)

    &gt;&gt;&gt; nse.option_chain(&#39;INFY&#39;,expiry=dt.date(2020,6,30))

    &#34;&#34;&#34;
    dir = f&#34;{self.dir[&#39;option_chain&#39;]}{symbol}/&#34;
    if not os.path.exists(dir):
        os.mkdir(dir)

    if req_date is None:
        q = self.get_quote(np.random.choice(self.symbols[&#39;FnO&#39;]))
        logger.debug(&#39;got timestamp&#39;)
        timestamp = q[&#39;timestamp&#39;] if q is not None else None

        if timestamp.date() == dt.date.today() and timestamp.time() &lt;= dt.time(15, 30):
            filename = f&#34;{dir}{dt.date.today()}_{dt.datetime.now().strftime(&#39;%H%M%S&#39;)}.pkl&#34;
            download_req = True

        elif timestamp.date() == dt.date.today():
            filename = f&#34;{dir}{dt.date.today()}_eod.pkl&#34;

            download_req = False if os.path.exists(filename) else True

        else:
            prev_trading_day = self.___trading_days()[-1].date()
            filename = f&#34;{dir}{prev_trading_day}_eod.pkl&#34;

            download_req = False if os.path.exists(filename) else True

    else:
        if req_date == dt.date.today():
            q = self.get_quote()

            timestamp = dt.datetime.strptime(self.get_quote()[&#39;timestamp&#39;],
                                             &#34;%d-%b-%Y %H:%M:%S&#34;) if q is not None else None

            if timestamp.date() == dt.date.today() and timestamp.time() &lt;= dt.time(15, 30):
                filename = f&#34;{dir}{req_date}_{dt.datetime.now().strftime(&#39;%H%M%S&#39;)}.pkl&#34;
                download_req = True

            else:
                filename = f&#34;{dir}{req_date}_eod.pkl&#34;
                download_req = False if os.path.exists(filename) else True
        else:
            prev_trading_day = self.___trading_days()[-1]
            if req_date &gt;= prev_trading_day:
                filename = f&#34;{dir}{prev_trading_day}_eod.pkl&#34;
                download_req = False if os.path.exists(filename) else True
            else:
                filename = f&#34;{dir}{req_date}_eod.pkl&#34;
                download_req = False

    if download_req:
        data = self.__option_chain_download(symbol)
        self.__save_object(data, filename, Format.pkl)
    data = self.__read_object(filename, Format.pkl)
    expiry_list = data[&#39;records&#39;][&#39;expiryDates&#39;]
    option_chain = pd.json_normalize(data[&#39;records&#39;][&#39;data&#39;])
    timestamp = data[&#39;records&#39;][&#39;timestamp&#39;]
    return {&#39;timestamp&#39;: timestamp, &#39;data&#39;: option_chain, &#39;expiry_list&#39;: expiry_list}</code></pre>
</details>
</dd>
<dt id="pynse.pynse.Nse.pre_open"><code class="name flex">
<span>def <span class="ident">pre_open</span></span>(<span>self) >pandas.core.frame.DataFrame</span>
</code></dt>
<dd>
<div class="desc"><p>get pre open data from nse</p>
<h2 id="examples">Examples</h2>
<pre><code class="python">&gt;&gt;&gt; nse.pre_open()
</code></pre></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def pre_open(self) -&gt; pd.DataFrame:
    &#34;&#34;&#34;

    get pre open data from nse

    Examples
    --------

    &gt;&gt;&gt; nse.pre_open()

    &#34;&#34;&#34;
    logger.debug(&#34;downloading preopen data&#34;)
    config = self.__service_config
    url = config[&#39;host&#39;] + config[&#39;path&#39;][&#39;preOpen&#39;]

    data = self.__get_resp(url).json()
    pre_open_data = pd.DataFrame([{
        &#34;symbol&#34;:
            i[&#34;metadata&#34;][&#34;symbol&#34;],
        &#34;preOpen&#34;:
            i[&#34;metadata&#34;][&#34;lastPrice&#34;],
        &#34;change&#34;:
            i[&#34;metadata&#34;][&#34;change&#34;],
        &#34;pChange&#34;:
            i[&#34;metadata&#34;][&#34;pChange&#34;],
        &#34;finalQuantity&#34;:
            i[&#34;metadata&#34;][&#34;finalQuantity&#34;],
        &#34;lastUpdateTime&#34;:
            i[&#34;detail&#34;][&#34;preOpenMarket&#34;][&#39;lastUpdateTime&#39;]
    } for i in data[&#34;data&#34;]])

    pre_open_data = pre_open_data.set_index(&#34;symbol&#34;)
    pre_open_data[&#34;lastUpdateTime&#34;] = pre_open_data[&#34;lastUpdateTime&#34;].apply(
        lambda x: dt.datetime.strptime(x, &#39;%d-%b-%Y %H:%M:%S&#39;))

    filename = f&#34;{self.dir[&#39;pre_open&#39;]}{pre_open_data[&#39;lastUpdateTime&#39;][-1].date()}.pkl&#34;
    pre_open_data.to_pickle(filename)

    return pre_open_data</code></pre>
</details>
</dd>
<dt id="pynse.pynse.Nse.top_gainers"><code class="name flex">
<span>def <span class="ident">top_gainers</span></span>(<span>self, length:int=10) >pandas.core.frame.DataFrame</span>
</code></dt>
<dd>
<div class="desc"><p>presently works only for SECURITIES IN F&amp;O</p>
<h2 id="examples">Examples</h2>
<pre><code class="python">&gt;&gt;&gt; nse.top_gainers(10)
</code></pre></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def top_gainers(self, length: int = 10) -&gt; pd.DataFrame:
    &#34;&#34;&#34;
    presently works only for SECURITIES IN F&amp;O

    Examples
    --------

    &gt;&gt;&gt; nse.top_gainers(10)

    &#34;&#34;&#34;
    return self.__gainers_losers(sort=0, length=length)</code></pre>
</details>
</dd>
<dt id="pynse.pynse.Nse.top_losers"><code class="name flex">
<span>def <span class="ident">top_losers</span></span>(<span>self, length:int=10) >pandas.core.frame.DataFrame</span>
</code></dt>
<dd>
<div class="desc"><p>presently works only for SECURITIES IN F&amp;O</p>
<h2 id="examples">Examples</h2>
<pre><code class="python">&gt;&gt;&gt; nse.top_losers(10)
</code></pre></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def top_losers(self, length: int = 10) -&gt; pd.DataFrame:
    &#34;&#34;&#34;
    presently works only for SECURITIES IN F&amp;O

    Examples
    --------

    &gt;&gt;&gt; nse.top_losers(10)

    &#34;&#34;&#34;
    return self.__gainers_losers(sort=1, length=length)</code></pre>
</details>
</dd>
<dt id="pynse.pynse.Nse.update_symbol_list"><code class="name flex">
<span>def <span class="ident">update_symbol_list</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Update list of symbols
no need to run frequently
required when constituent of an index is changed
or
list of securities in fno are updates
:return: None</p>
<p>Examples:</p>
<pre><code class="python">&gt;&gt;&gt; nse.update_symbol_list()
</code></pre></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def update_symbol_list(self):
    &#34;&#34;&#34;
    Update list of symbols
    no need to run frequently
    required when constituent of an index is changed
    or
    list of securities in fno are updates
    :return: None

    Examples:

    &gt;&gt;&gt; nse.update_symbol_list()

    &#34;&#34;&#34;
    for i in [a for a in IndexSymbol]:
        self.__symbol_list(i)
        time.sleep(1)</code></pre>
</details>
</dd>
</dl>
</dd>
<dt id="pynse.pynse.OptionType"><code class="flex name class">
<span>class <span class="ident">OptionType</span></span>
<span>(</span><span>value, names=None, *, module=None, qualname=None, type=None, start=1)</span>
</code></dt>
<dd>
<div class="desc"><p>An enumeration.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class OptionType(enum.Enum):
    CE = &#39;Call&#39;
    PE = &#39;Put&#39;</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li>enum.Enum</li>
</ul>
<h3>Class variables</h3>
<dl>
<dt id="pynse.pynse.OptionType.CE"><code class="name">var <span class="ident">CE</span></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="pynse.pynse.OptionType.PE"><code class="name">var <span class="ident">PE</span></code></dt>
<dd>
<div class="desc"></div>
</dd>
</dl>
</dd>
<dt id="pynse.pynse.OutputType"><code class="flex name class">
<span>class <span class="ident">OutputType</span></span>
<span>(</span><span>value, names=None, *, module=None, qualname=None, type=None, start=1)</span>
</code></dt>
<dd>
<div class="desc"><p>An enumeration.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class OutputType(enum.Enum):
    pandas = &#39;pd&#39;
    dict = &#39;json&#39;</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li>enum.Enum</li>
</ul>
<h3>Class variables</h3>
<dl>
<dt id="pynse.pynse.OutputType.dict"><code class="name">var <span class="ident">dict</span></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="pynse.pynse.OutputType.pandas"><code class="name">var <span class="ident">pandas</span></code></dt>
<dd>
<div class="desc"></div>
</dd>
</dl>
</dd>
<dt id="pynse.pynse.Segment"><code class="flex name class">
<span>class <span class="ident">Segment</span></span>
<span>(</span><span>value, names=None, *, module=None, qualname=None, type=None, start=1)</span>
</code></dt>
<dd>
<div class="desc"><p>An enumeration.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class Segment(enum.Enum):
    EQ = &#39;EQ&#39;
    FUT = &#39;FUT&#39;
    OPT = &#39;OPT&#39;</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li>enum.Enum</li>
</ul>
<h3>Class variables</h3>
<dl>
<dt id="pynse.pynse.Segment.EQ"><code class="name">var <span class="ident">EQ</span></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="pynse.pynse.Segment.FUT"><code class="name">var <span class="ident">FUT</span></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="pynse.pynse.Segment.OPT"><code class="name">var <span class="ident">OPT</span></code></dt>
<dd>
<div class="desc"></div>
</dd>
</dl>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="pynse" href="index.html">pynse</a></code></li>
</ul>
</li>
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="pynse.pynse.Format" href="#pynse.pynse.Format">Format</a></code></h4>
<ul class="">
<li><code><a title="pynse.pynse.Format.csv" href="#pynse.pynse.Format.csv">csv</a></code></li>
<li><code><a title="pynse.pynse.Format.pkl" href="#pynse.pynse.Format.pkl">pkl</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="pynse.pynse.IndexSymbol" href="#pynse.pynse.IndexSymbol">IndexSymbol</a></code></h4>
<ul class="two-column">
<li><code><a title="pynse.pynse.IndexSymbol.All" href="#pynse.pynse.IndexSymbol.All">All</a></code></li>
<li><code><a title="pynse.pynse.IndexSymbol.FnO" href="#pynse.pynse.IndexSymbol.FnO">FnO</a></code></li>
<li><code><a title="pynse.pynse.IndexSymbol.Nifty100" href="#pynse.pynse.IndexSymbol.Nifty100">Nifty100</a></code></li>
<li><code><a title="pynse.pynse.IndexSymbol.Nifty100EqlWgt" href="#pynse.pynse.IndexSymbol.Nifty100EqlWgt">Nifty100EqlWgt</a></code></li>
<li><code><a title="pynse.pynse.IndexSymbol.Nifty100Lowvol30" href="#pynse.pynse.IndexSymbol.Nifty100Lowvol30">Nifty100Lowvol30</a></code></li>
<li><code><a title="pynse.pynse.IndexSymbol.Nifty200" href="#pynse.pynse.IndexSymbol.Nifty200">Nifty200</a></code></li>
<li><code><a title="pynse.pynse.IndexSymbol.Nifty200Qualty30" href="#pynse.pynse.IndexSymbol.Nifty200Qualty30">Nifty200Qualty30</a></code></li>
<li><code><a title="pynse.pynse.IndexSymbol.Nifty50" href="#pynse.pynse.IndexSymbol.Nifty50">Nifty50</a></code></li>
<li><code><a title="pynse.pynse.IndexSymbol.Nifty500" href="#pynse.pynse.IndexSymbol.Nifty500">Nifty500</a></code></li>
<li><code><a title="pynse.pynse.IndexSymbol.Nifty50EqlWgt" href="#pynse.pynse.IndexSymbol.Nifty50EqlWgt">Nifty50EqlWgt</a></code></li>
<li><code><a title="pynse.pynse.IndexSymbol.Nifty50Value20" href="#pynse.pynse.IndexSymbol.Nifty50Value20">Nifty50Value20</a></code></li>
<li><code><a title="pynse.pynse.IndexSymbol.NiftyAlpha50" href="#pynse.pynse.IndexSymbol.NiftyAlpha50">NiftyAlpha50</a></code></li>
<li><code><a title="pynse.pynse.IndexSymbol.NiftyAuto" href="#pynse.pynse.IndexSymbol.NiftyAuto">NiftyAuto</a></code></li>
<li><code><a title="pynse.pynse.IndexSymbol.NiftyBank" href="#pynse.pynse.IndexSymbol.NiftyBank">NiftyBank</a></code></li>
<li><code><a title="pynse.pynse.IndexSymbol.NiftyCommodities" href="#pynse.pynse.IndexSymbol.NiftyCommodities">NiftyCommodities</a></code></li>
<li><code><a title="pynse.pynse.IndexSymbol.NiftyConsumption" href="#pynse.pynse.IndexSymbol.NiftyConsumption">NiftyConsumption</a></code></li>
<li><code><a title="pynse.pynse.IndexSymbol.NiftyEnergy" href="#pynse.pynse.IndexSymbol.NiftyEnergy">NiftyEnergy</a></code></li>
<li><code><a title="pynse.pynse.IndexSymbol.NiftyFinService" href="#pynse.pynse.IndexSymbol.NiftyFinService">NiftyFinService</a></code></li>
<li><code><a title="pynse.pynse.IndexSymbol.NiftyFmcg" href="#pynse.pynse.IndexSymbol.NiftyFmcg">NiftyFmcg</a></code></li>
<li><code><a title="pynse.pynse.IndexSymbol.NiftyInfra" href="#pynse.pynse.IndexSymbol.NiftyInfra">NiftyInfra</a></code></li>
<li><code><a title="pynse.pynse.IndexSymbol.NiftyIt" href="#pynse.pynse.IndexSymbol.NiftyIt">NiftyIt</a></code></li>
<li><code><a title="pynse.pynse.IndexSymbol.NiftyMedia" href="#pynse.pynse.IndexSymbol.NiftyMedia">NiftyMedia</a></code></li>
<li><code><a title="pynse.pynse.IndexSymbol.NiftyMetal" href="#pynse.pynse.IndexSymbol.NiftyMetal">NiftyMetal</a></code></li>
<li><code><a title="pynse.pynse.IndexSymbol.NiftyMidcap100" href="#pynse.pynse.IndexSymbol.NiftyMidcap100">NiftyMidcap100</a></code></li>
<li><code><a title="pynse.pynse.IndexSymbol.NiftyMidcap150" href="#pynse.pynse.IndexSymbol.NiftyMidcap150">NiftyMidcap150</a></code></li>
<li><code><a title="pynse.pynse.IndexSymbol.NiftyMidcap50" href="#pynse.pynse.IndexSymbol.NiftyMidcap50">NiftyMidcap50</a></code></li>
<li><code><a title="pynse.pynse.IndexSymbol.NiftyMidsml400" href="#pynse.pynse.IndexSymbol.NiftyMidsml400">NiftyMidsml400</a></code></li>
<li><code><a title="pynse.pynse.IndexSymbol.NiftyMnc" href="#pynse.pynse.IndexSymbol.NiftyMnc">NiftyMnc</a></code></li>
<li><code><a title="pynse.pynse.IndexSymbol.NiftyNext50" href="#pynse.pynse.IndexSymbol.NiftyNext50">NiftyNext50</a></code></li>
<li><code><a title="pynse.pynse.IndexSymbol.NiftyPharma" href="#pynse.pynse.IndexSymbol.NiftyPharma">NiftyPharma</a></code></li>
<li><code><a title="pynse.pynse.IndexSymbol.NiftyPse" href="#pynse.pynse.IndexSymbol.NiftyPse">NiftyPse</a></code></li>
<li><code><a title="pynse.pynse.IndexSymbol.NiftyPsuBank" href="#pynse.pynse.IndexSymbol.NiftyPsuBank">NiftyPsuBank</a></code></li>
<li><code><a title="pynse.pynse.IndexSymbol.NiftyPvtBank" href="#pynse.pynse.IndexSymbol.NiftyPvtBank">NiftyPvtBank</a></code></li>
<li><code><a title="pynse.pynse.IndexSymbol.NiftyRealty" href="#pynse.pynse.IndexSymbol.NiftyRealty">NiftyRealty</a></code></li>
<li><code><a title="pynse.pynse.IndexSymbol.NiftyServSector" href="#pynse.pynse.IndexSymbol.NiftyServSector">NiftyServSector</a></code></li>
<li><code><a title="pynse.pynse.IndexSymbol.NiftySmlcap100" href="#pynse.pynse.IndexSymbol.NiftySmlcap100">NiftySmlcap100</a></code></li>
<li><code><a title="pynse.pynse.IndexSymbol.NiftySmlcap250" href="#pynse.pynse.IndexSymbol.NiftySmlcap250">NiftySmlcap250</a></code></li>
<li><code><a title="pynse.pynse.IndexSymbol.NiftySmlcap50" href="#pynse.pynse.IndexSymbol.NiftySmlcap50">NiftySmlcap50</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="pynse.pynse.Nse" href="#pynse.pynse.Nse">Nse</a></code></h4>
<ul class="two-column">
<li><code><a title="pynse.pynse.Nse.bhavcopy" href="#pynse.pynse.Nse.bhavcopy">bhavcopy</a></code></li>
<li><code><a title="pynse.pynse.Nse.bhavcopy_fno" href="#pynse.pynse.Nse.bhavcopy_fno">bhavcopy_fno</a></code></li>
<li><code><a title="pynse.pynse.Nse.fii_dii" href="#pynse.pynse.Nse.fii_dii">fii_dii</a></code></li>
<li><code><a title="pynse.pynse.Nse.get_hist" href="#pynse.pynse.Nse.get_hist">get_hist</a></code></li>
<li><code><a title="pynse.pynse.Nse.get_indices" href="#pynse.pynse.Nse.get_indices">get_indices</a></code></li>
<li><code><a title="pynse.pynse.Nse.get_quote" href="#pynse.pynse.Nse.get_quote">get_quote</a></code></li>
<li><code><a title="pynse.pynse.Nse.info" href="#pynse.pynse.Nse.info">info</a></code></li>
<li><code><a title="pynse.pynse.Nse.market_status" href="#pynse.pynse.Nse.market_status">market_status</a></code></li>
<li><code><a title="pynse.pynse.Nse.option_chain" href="#pynse.pynse.Nse.option_chain">option_chain</a></code></li>
<li><code><a title="pynse.pynse.Nse.pre_open" href="#pynse.pynse.Nse.pre_open">pre_open</a></code></li>
<li><code><a title="pynse.pynse.Nse.top_gainers" href="#pynse.pynse.Nse.top_gainers">top_gainers</a></code></li>
<li><code><a title="pynse.pynse.Nse.top_losers" href="#pynse.pynse.Nse.top_losers">top_losers</a></code></li>
<li><code><a title="pynse.pynse.Nse.update_symbol_list" href="#pynse.pynse.Nse.update_symbol_list">update_symbol_list</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="pynse.pynse.OptionType" href="#pynse.pynse.OptionType">OptionType</a></code></h4>
<ul class="">
<li><code><a title="pynse.pynse.OptionType.CE" href="#pynse.pynse.OptionType.CE">CE</a></code></li>
<li><code><a title="pynse.pynse.OptionType.PE" href="#pynse.pynse.OptionType.PE">PE</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="pynse.pynse.OutputType" href="#pynse.pynse.OutputType">OutputType</a></code></h4>
<ul class="">
<li><code><a title="pynse.pynse.OutputType.dict" href="#pynse.pynse.OutputType.dict">dict</a></code></li>
<li><code><a title="pynse.pynse.OutputType.pandas" href="#pynse.pynse.OutputType.pandas">pandas</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="pynse.pynse.Segment" href="#pynse.pynse.Segment">Segment</a></code></h4>
<ul class="">
<li><code><a title="pynse.pynse.Segment.EQ" href="#pynse.pynse.Segment.EQ">EQ</a></code></li>
<li><code><a title="pynse.pynse.Segment.FUT" href="#pynse.pynse.Segment.FUT">FUT</a></code></li>
<li><code><a title="pynse.pynse.Segment.OPT" href="#pynse.pynse.Segment.OPT">OPT</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc"><cite>pdoc</cite> 0.8.3</a>.</p>
</footer>
</body>
</html>